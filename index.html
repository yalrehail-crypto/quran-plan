<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</title>

  <style>
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background:#0b1220;
      color:#fff;
      margin:0;
      padding:20px;
      text-align:center;
    }
    .card{
      max-width:520px;
      margin:20px auto;
      background:#121b31;
      border-radius:18px;
      padding:22px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h1{ margin:0 0 12px 0; font-size:34px; }
    .sub{
      color:#cbd5e1;
      margin:8px 0;
      font-size:18px;
      line-height:1.7;
    }
    .divider{
      height:1px;
      background:rgba(255,255,255,.12);
      margin:16px 0;
    }
    input{
      width:100%;
      box-sizing:border-box;
      padding:16px;
      border-radius:14px;
      border:none;
      outline:none;
      font-size:22px;
      text-align:right;
      background:#fff;
      color:#111827;
      margin:10px 0;
    }
    button{
      width:100%;
      padding:18px;
      border:none;
      border-radius:14px;
      background:#3461ff;
      color:#fff;
      font-size:22px;
      cursor:pointer;
      margin-top:6px;
    }
    button:active{ transform: scale(.99); }

    #result{
      margin-top:16px;
      font-size:22px;
      line-height:1.9;
      color:#93c5fd;
      white-space:pre-line;
    }

    #error{
      margin-top:12px;
      color:#93c5fd;
      font-size:20px;
      min-height: 28px;
    }

    .footer{
      margin-top:18px;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.12);
      color:#9ca3af;
      font-size:15px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>ğŸ“– Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</h1>

    <!-- ÙÙ‚Ø·: Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ + Ø§Ù„ÙˆÙ‚Øª -->
    <div class="sub" id="hijriDateLine">...</div>
    <div class="sub" id="timeLine">...</div>

    <div class="divider"></div>

    <input id="currentPage" type="number" inputmode="numeric"
           placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù„ÙŠ ÙˆØµÙ„Øª Ù„Ù‡Ø§ (1 - 604)" />

    <button onclick="calculatePlan()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©</button>

    <div id="result"></div>
    <div id="error"></div>

    <div class="footer">ğŸ”¥ğŸ’» Ù…Ø¹ ØªØ­ÙŠØ§Øª :Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø±Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¯Ø¨Ù„Ù‡</div>
  </div>

  <script>
    const TOTAL_PAGES = 604;

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©/Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ù„Ø§ØªÙŠÙ†ÙŠØ©
    function toLatinDigits(str) {
      return String(str)
        .replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d))
        .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d));
    }

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©) Ø¨Ø´ÙƒÙ„ Ø«Ø§Ø¨Øª
    function getHijriParts(date) {
      const fmt = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {
        day: "numeric", month: "numeric", year: "numeric"
      });
      const parts = fmt.formatToParts(date);
      const obj = {};
      for (const p of parts) {
        if (p.type === "day") obj.day = parseInt(toLatinDigits(p.value), 10);
        if (p.type === "month") obj.month = parseInt(toLatinDigits(p.value), 10);
        if (p.type === "year") obj.year = parseInt(toLatinDigits(p.value), 10);
      }
      return obj;
    }

    // Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ
    function getHijriMonthName(date) {
      return new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { month: "long" }).format(date);
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ + Ø§Ù„ÙˆÙ‚Øª (Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± ÙˆØ¨Ø¯ÙˆÙ† Ø±Ù…Ø¶Ø§Ù†)
    function updateHeader() {
      const now = new Date();

      const hijriDayName = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { weekday: "long" }).format(now);
      const hijriDate = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { day: "numeric", month: "long", year: "numeric" }).format(now);

      const time = new Intl.DateTimeFormat("ar-SA", {
        hour: "numeric", minute: "2-digit", second: "2-digit"
      }).format(now);

      document.getElementById("hijriDateLine").textContent = "ğŸ“… " + hijriDayName + "ØŒ " + hijriDate;
      document.getElementById("timeLine").textContent = "â° " + time;
    }

    // Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø´Ø§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…) â€” Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‡Ø¬Ø±ÙŠ
    function getDaysLeftInHijriMonthInclusive() {
      const today = new Date();
      const hNow = getHijriParts(today);

      let temp = new Date(today);
      let daysUntilMonthEnds = 0;

      // Ù†Ù…Ø´ÙŠ ÙŠÙˆÙ… ÙŠÙˆÙ… Ù„ÙŠÙ† ÙŠØªØºÙŠØ± Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ
      while (true) {
        temp.setDate(temp.getDate() + 1);
        const hTemp = getHijriParts(temp);

        if (hTemp.month !== hNow.month || hTemp.year !== hNow.year) break;

        daysUntilMonthEnds++;
        if (daysUntilMonthEnds > 40) break; // Ø­Ù…Ø§ÙŠØ©
      }

      return daysUntilMonthEnds + 1; // Ø´Ø§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…
    }

    function calculatePlan() {
      const input = document.getElementById("currentPage").value;
      const current = parseInt(input, 10);

      const result = document.getElementById("result");
      const error = document.getElementById("error");
      result.textContent = "";
      error.textContent = "";

      if (isNaN(current) || current < 1 || current > TOTAL_PAGES) {
        error.textContent = "âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµÙØ­Ø© ØµØ­ÙŠØ­ Ø¨ÙŠÙ† 1 Ùˆ 604";
        return;
      }

      const remaining = TOTAL_PAGES - current;

      if (remaining === 0) {
        result.textContent = "âœ… Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø£Ù†Øª Ø®ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø¢Ù† ğŸ‰";
        return;
      }

      const daysLeft = getDaysLeftInHijriMonthInclusive();
      const perDay = Math.ceil(remaining / daysLeft);

      const monthName = getHijriMonthName(new Date());

      result.textContent =
        "ğŸ“˜ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: " + remaining + "\n" +
        "ğŸ“… Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø´Ù‡Ø± " + monthName + " (Ù‡Ø¬Ø±ÙŠ): " + daysLeft + "\n" +
        "ğŸ“– Ø§Ù‚Ø±Ø£ ÙŠÙˆÙ…ÙŠØ§Ù‹: " + perDay + " ØµÙØ­Ø©\n" +
        "âœ… Ù„ØªØ®ØªÙ… Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ";
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    updateHeader();
    setInterval(updateHeader, 1000);
  </script>
</body>
</html>
