<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</title>

  <style>
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background:#0b1220;
      color:#fff;
      margin:0;
      padding:20px;
      text-align:center;
    }
    .card{
      max-width:560px;
      margin:20px auto;
      background:#121b31;
      border-radius:18px;
      padding:22px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h1{ margin:0 0 12px 0; font-size:34px; }
    .sub{
      color:#cbd5e1;
      margin:8px 0;
      font-size:18px;
      line-height:1.7;
    }
    .divider{
      height:1px;
      background:rgba(255,255,255,.12);
      margin:16px 0;
    }
    input{
      width:100%;
      box-sizing:border-box;
      padding:16px;
      border-radius:14px;
      border:none;
      outline:none;
      font-size:22px;
      text-align:right;
      background:#fff;
      color:#111827;
      margin:10px 0;
    }
    button{
      width:100%;
      padding:18px;
      border:none;
      border-radius:14px;
      background:#3461ff;
      color:#fff;
      font-size:22px;
      cursor:pointer;
      margin-top:10px;
    }
    button:active{ transform: scale(.99); }

    .modeBox{
      text-align:right;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:14px;
      margin-top:10px;
    }
    .modeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-start;
      margin-top:10px;
    }
    label{ cursor:pointer; }
    select{
      flex:1;
      min-width:150px;
      padding:12px;
      border-radius:12px;
      border:none;
      outline:none;
      font-size:18px;
    }

    #result{
      margin-top:16px;
      font-size:22px;
      line-height:1.9;
      color:#93c5fd;
      white-space:pre-line;
    }
    #error{
      margin-top:12px;
      color:#93c5fd;
      font-size:20px;
      min-height: 28px;
    }
    .footer{
      margin-top:18px;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,.12);
      color:#9ca3af;
      font-size:15px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>ğŸ“– Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</h1>

    <div class="sub" id="hijriDateLine">...</div>
    <div class="sub" id="timeLine">...</div>

    <div class="divider"></div>

    <input id="currentPage" type="number" inputmode="numeric"
           placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù„ÙŠ ÙˆØµÙ„Øª Ù„Ù‡Ø§ (1 - 604)" />

    <div class="modeBox">
      <div style="font-size:18px; color:#cbd5e1;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:</div>

      <div class="modeRow">
        <label>
          <input type="radio" name="mode" value="hijriMonth" checked onchange="toggleModeUI()">
          Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„: Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)
        </label>
      </div>

      <div class="modeRow">
        <label>
          <input type="radio" name="mode" value="days" onchange="toggleModeUI()">
          Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø­Ø³Ø¨ Ù…Ø¯Ø© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)
        </label>

        <select id="daysSelect" disabled>
          <option value="60">60 ÙŠÙˆÙ…</option>
          <option value="30" selected>30 ÙŠÙˆÙ…</option>
          <option value="15">15 ÙŠÙˆÙ…</option>
        </select>
      </div>
    </div>

    <button onclick="calculatePlan()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©</button>

    <div id="result"></div>
    <div id="error"></div>

    <div class="footer">ğŸ”¥ğŸ’» Ù…Ø¹ ØªØ­ÙŠØ§Øª :Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø±Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¯Ø¨Ù„Ù‡</div>
  </div>

  <script>
    const TOTAL_PAGES = 604;

    function toLatinDigits(str) {
      return String(str)
        .replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d))
        .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d));
    }

    function getHijriParts(date) {
      const fmt = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {
        day: "numeric", month: "numeric", year: "numeric"
      });
      const parts = fmt.formatToParts(date);
      const obj = {};
      for (const p of parts) {
        if (p.type === "day") obj.day = parseInt(toLatinDigits(p.value), 10);
        if (p.type === "month") obj.month = parseInt(toLatinDigits(p.value), 10);
        if (p.type === "year") obj.year = parseInt(toLatinDigits(p.value), 10);
      }
      return obj;
    }

    function getHijriMonthName(date) {
      return new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { month: "long" }).format(date);
    }

    function updateHeader() {
      const now = new Date();
      const hijriDayName = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { weekday: "long" }).format(now);
      const hijriDate = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", { day: "numeric", month: "long", year: "numeric" }).format(now);

      const time = new Intl.DateTimeFormat("ar-SA", {
        hour: "numeric", minute: "2-digit", second: "2-digit"
      }).format(now);

      document.getElementById("hijriDateLine").textContent = "ğŸ“… " + hijriDayName + "ØŒ " + hijriDate;
      document.getElementById("timeLine").textContent = "â° " + time;
    }

    // Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø´Ø§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…)
    function getDaysLeftInHijriMonthInclusive() {
      const today = new Date();
      const hNow = getHijriParts(today);

      let d = new Date(today);
      let count = 1; // Ø´Ø§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…

      while (true) {
        d.setDate(d.getDate() + 1);
        const h = getHijriParts(d);

        if (h.day === 1 && (h.month !== hNow.month || h.year !== hNow.year)) {
          break;
        }

        count++;
        if (count > 35) break; // Ø­Ù…Ø§ÙŠØ©
      }

      return count;
    }

    function getSelectedMode() {
      return document.querySelector('input[name="mode"]:checked').value;
    }

    function toggleModeUI() {
      const mode = getSelectedMode();
      const daysSelect = document.getElementById("daysSelect");
      daysSelect.disabled = (mode !== "days");
    }

    function calculatePlan() {
      const input = document.getElementById("currentPage").value;
      const current = parseInt(input, 10);

      const result = document.getElementById("result");
      const error = document.getElementById("error");
      result.textContent = "";
      error.textContent = "";

      if (isNaN(current) || current < 1 || current > TOTAL_PAGES) {
        error.textContent = "âŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµÙØ­Ø© ØµØ­ÙŠØ­ Ø¨ÙŠÙ† 1 Ùˆ 604";
        return;
      }

      const remaining = TOTAL_PAGES - current;

      if (remaining === 0) {
        result.textContent = "âœ… Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø£Ù†Øª Ø®ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø¢Ù† ğŸ‰";
        return;
      }

      const mode = getSelectedMode();
      let daysLeft = 0;
      let titleLine = "";

      if (mode === "hijriMonth") {
        daysLeft = getDaysLeftInHijriMonthInclusive();
        const monthName = getHijriMonthName(new Date());
        titleLine = "ğŸ“… Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø´Ù‡Ø± " + monthName + " (Ù‡Ø¬Ø±ÙŠ): " + daysLeft;
      } else {
        daysLeft = parseInt(document.getElementById("daysSelect").value, 10);
        titleLine = "ğŸ“… Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: " + daysLeft + " ÙŠÙˆÙ…";
      }

      // Ø­Ù…Ø§ÙŠØ©: Ù„Ùˆ Ø§Ø®ØªØ§Ø± 0 Ø¨Ø§Ù„ØºÙ„Ø·
      if (!daysLeft || daysLeft < 1) {
        error.textContent = "âŒ Ø§Ù„Ù…Ø¯Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
        return;
      }

      const perDay = Math.ceil(remaining / daysLeft);

      result.textContent =
        "ğŸ“˜ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: " + remaining + "\n" +
        titleLine + "\n" +
        "ğŸ“– Ù„Ø§Ø²Ù… ØªÙ‚Ø±Ø£ ÙŠÙˆÙ…ÙŠØ§Ù‹: " + perDay + " ØµÙØ­Ø©\n" +
        "âœ… Ø¹Ø´Ø§Ù† ØªØ®ØªÙ… Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¯Ø©";
    }

    toggleModeUI();
    updateHeader();
    setInterval(updateHeader, 1000);
  </script>
</body>
</html>
