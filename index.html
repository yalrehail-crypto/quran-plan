<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</title>
  <style>
    :root{
      --bg:#081426;
      --card:#0f2140cc;
      --card2:#0c1b34cc;
      --text:#ffffff;
      --muted:#b9c6df;
      --muted2:#93a4c6;
      --accent:#3f66ff;
      --accent2:#2b4dd6;
      --white:#ffffff;
      --input:#f3f5f9;
      --shadow: 0 20px 50px rgba(0,0,0,.35);
      --radius: 26px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% -200px, #143261 0%, var(--bg) 55%, #050b14 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:24px 14px 60px;
    }

    .wrap{ width:min(720px, 100%); }

    .card{
      background: linear-gradient(180deg, rgba(14,33,70,.95), rgba(10,22,45,.92));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px 18px 22px;
      overflow:hidden;
    }

    .title{
      text-align:center;
      font-weight:900;
      letter-spacing:.5px;
      font-size: clamp(34px, 6vw, 58px);
      margin: 4px 0 6px;
    }
    .title .emoji{ font-size: .65em; vertical-align: middle; margin-right:10px;}
    .sub{
      text-align:center;
      color:var(--muted);
      font-size: clamp(16px, 2.4vw, 20px);
      line-height:1.7;
      margin: 0 0 8px;
    }
    .time{
      text-align:center;
      color:var(--muted);
      font-size: clamp(18px, 2.6vw, 22px);
      margin: 6px 0 16px;
    }

    hr.sep{
      border:none;
      height:1px;
      background: rgba(255,255,255,.12);
      margin: 14px 0 18px;
    }

    /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙØ­Ø© (Ø¨Ø±Ù†Ø§Ù…Ø¬/ØªÙ‚ÙˆÙŠÙ…) */
    .topSelectWrap{ margin-bottom: 15px; }
    .topSelect{
      width:100%;
      padding:14px;
      border-radius:18px;
      font-size:18px;
      font-weight:800;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--white);
      outline:none;
      cursor:pointer;
    }
    .topSelect option{ color:#000; }

    /* Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ */
    .sectionTitle{
      text-align:center;
      font-size: 22px;
      color: var(--muted);
      font-weight: 800;
      margin: 8px 0 14px;
    }

    .modeBox{
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 14px;
      display:grid;
      gap: 12px;
      margin-bottom: 14px;
    }

    .modeRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      cursor:pointer;
    }

    .modeLeft{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .radio{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.45);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }
    .radio .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: transparent;
    }
    .modeRow.active .radio{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(63,102,255,.22);
    }
    .modeRow.active .radio .dot{ background: var(--accent); }

    .modeText{ min-width:0; }
    .modeText b{
      display:block;
      font-size: 18px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .modeText small{
      display:block;
      color: var(--muted2);
      margin-top: 2px;
      font-size: 13px;
    }

    .pill{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 10px 12px;
      border-radius: 16px;
      display:flex;
      align-items:center;
      gap: 8px;
      flex: 0 0 auto;
    }
    .pill select{
      background: transparent;
      border:none;
      color: var(--white);
      outline:none;
      font-size: 16px;
      font-weight: 800;
      appearance: none;
      padding: 0 6px;
      cursor:pointer;
    }
    .pill option{ color:#000; }

    /* Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙØ­Ø© */
    .input{
      width:100%;
      border:none;
      outline:none;
      background: var(--input);
      padding: 18px 16px;
      border-radius: 22px;
      font-size: 24px;
      font-weight: 800;
      text-align: right;
      color:#111827;
      box-shadow: inset 0 2px 0 rgba(0,0,0,.06);
    }

    .btn{
      width:100%;
      margin-top: 14px;
      border:none;
      outline:none;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      color: white;
      padding: 18px 16px;
      border-radius: 24px;
      font-size: 30px;
      font-weight: 900;
      cursor:pointer;
      box-shadow: 0 18px 45px rgba(63,102,255,.35);
      transition: transform .06s ease;
    }
    .btn:active{ transform: scale(.99); }

    .result{
      text-align:center;
      margin-top: 18px;
      color: #a9c5ff;
      font-size: clamp(22px, 3.6vw, 34px);
      line-height: 1.9;
      font-weight: 900;
    }
    .result b{ color:#dbe8ff; }

    .note{
      margin-top: 10px;
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size: 14px;
    }

    /* Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… */
    .duaCard{
      margin-top: 16px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 22px;
      padding: 18px 14px;
      text-align:center;
    }
    .duaTitle{
      font-size: 22px;
      font-weight: 900;
      margin: 0 0 10px;
      color: #e9f1ff;
    }
    .duaText{
      margin:0;
      font-size: 20px;
      line-height: 1.9;
      color: rgba(255,255,255,.90);
      font-weight: 700;
    }

    /* ÙŠÙˆØªÙŠÙˆØ¨ */
    .ytCard{
      margin-top: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 22px;
      padding: 16px 14px 18px;
      text-align:center;
    }
    .ytTitle{
      margin:0 0 12px;
      font-size: 20px;
      font-weight: 900;
      color:#e9f1ff;
    }
    .ytWrap{
      width:100%;
      aspect-ratio: 16 / 9;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.08);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }

    .footer{
      margin-top: 16px;
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size: 14px;
      font-weight: 700;
    }

    /* =========================
       ØµÙØ­Ø© ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© - Ø¨Ø·Ø§Ù‚Ø§Øª
       ========================= */
    .calGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 8px;
    }
    .calTile{
      position:relative;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding: 18px 14px;
      min-height: 92px;
      cursor:pointer;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      box-shadow: 0 14px 35px rgba(0,0,0,.18);
      transition: transform .08s ease, border-color .08s ease;
    }
    .calTile:active{ transform: scale(.99); }
    .calTile::before{
      content:"";
      position:absolute;
      inset:-40px -40px auto auto;
      width: 160px;
      height: 160px;
      border-radius: 999px;
      filter: blur(0px);
      opacity: .55;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%);
      transform: rotate(12deg);
    }
    .calTile .tTitle{
      font-weight: 950;
      font-size: 22px;
      letter-spacing: .3px;
      color: rgba(255,255,255,.92);
      z-index:1;
      line-height: 1.25;
    }
    .calTile .tIcon{
      display:block;
      font-size: 26px;
      margin-bottom: 8px;
      opacity:.95;
    }

    .tileBlue{ background: linear-gradient(180deg, rgba(85,160,255,.18), rgba(255,255,255,.04)); }
    .tileGreen{ background: linear-gradient(180deg, rgba(90,220,160,.16), rgba(255,255,255,.04)); }
    .tileGold{ background: linear-gradient(180deg, rgba(255,205,90,.14), rgba(255,255,255,.04)); }
    .tileTeal{ background: linear-gradient(180deg, rgba(90,225,225,.14), rgba(255,255,255,.04)); }

    /* Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
    .modalOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 18px 12px;
      z-index: 9999;
    }
    .modal{
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(14,33,70,.98), rgba(10,22,45,.98));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalTitle{
      font-weight: 950;
      font-size: 20px;
      color: rgba(255,255,255,.95);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .closeBtn{
      border:none;
      outline:none;
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 900;
    }
    .modalBody{
      padding: 14px;
      max-height: 65vh;
      overflow:auto;
    }
    .infoLine{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 12px 12px;
      margin-bottom: 10px;
      line-height: 1.8;
      color: rgba(255,255,255,.90);
      font-weight: 750;
      font-size: 16px;
    }
    .infoLine small{
      display:block;
      color: rgba(255,255,255,.65);
      font-weight: 700;
      margin-top: 3px;
      font-size: 13px;
    }
    .loading{
      text-align:center;
      color: rgba(255,255,255,.78);
      font-weight: 900;
      padding: 10px 0 6px;
    }
    .hint{
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size: 13px;
      font-weight: 700;
      margin-top: 8px;
    }

    @media (max-width: 420px){
      .btn{ font-size: 28px; }
      .input{ font-size: 22px; }
      .topSelect{ font-size: 17px; }
      .calGrid{ grid-template-columns: 1fr 1fr; gap: 12px; }
      .calTile{ min-height: 88px; }
      .calTile .tTitle{ font-size: 20px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙØ­Ø© -->
      <div class="topSelectWrap">
        <select class="topSelect" id="pageSelect">
          <option value="quran" selected>ğŸ“– Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</option>
          <option value="calendar">ğŸ‡¸ğŸ‡¦ ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
        </select>
      </div>

      <!-- ØµÙØ­Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ -->
      <div id="quranPage">
        <div class="title">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù† <span class="emoji">ğŸ“–</span></div>
        <div class="sub" id="hijriDate">â€”</div>
        <div class="time" id="clock">â€”</div>

        <hr class="sep">

        <div class="sectionTitle">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>

        <div class="modeBox">
          <div class="modeRow active" id="rowMonth">
            <div class="modeLeft">
              <div class="radio"><div class="dot"></div></div>
              <div class="modeText">
                <b>Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)</b>
                <small>ÙŠØ­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</small>
              </div>
            </div>
            <div class="pill">ğŸ“…</div>
          </div>

          <div class="modeRow" id="rowDays">
            <div class="modeLeft">
              <div class="radio"><div class="dot"></div></div>
              <div class="modeText">
                <b>Ø­Ø³Ø¨ Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…</b>
                <small>Ø§Ø®ØªØ± 15 Ø£Ùˆ 30 Ø£Ùˆ 60 ÙŠÙˆÙ…</small>
              </div>
            </div>
            <div class="pill">
              â³
              <select id="daysSelect">
                <option value="15">15 ÙŠÙˆÙ…</option>
                <option value="30" selected>30 ÙŠÙˆÙ…</option>
                <option value="60">60 ÙŠÙˆÙ…</option>
              </select>
            </div>
          </div>
        </div>

        <input class="input" id="currentPage" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù„ÙŠ ÙˆØµÙ„Øª Ù„Ù‡Ø§" />
        <button class="btn" id="calcBtn">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©</button>

        <div class="result" id="result"></div>
        <div class="note">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ®/ÙˆÙ‚Øª Ø¬Ù‡Ø§Ø²Ùƒ.</div>

        <div class="duaCard">
          <div class="duaTitle">Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</div>
          <p class="duaText" id="duaText">â€”</p>
        </div>

        <div class="ytCard">
          <div class="ytTitle">Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
          <div class="ytWrap">
            <iframe
              id="ytFrame"
              title="YouTube Live"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
            ></iframe>
          </div>
        </div>

        <div class="footer">Ù…Ø¹ ØªØ­ÙŠØ§Øª: Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø±Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¯Ø¨Ù„Ù‡ ğŸ”¥ğŸ’»</div>
      </div>

      <!-- ØµÙØ­Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Ø¨Ø·Ø§Ù‚Ø§Øª) -->
      <div id="calendarPage" style="display:none;">
        <div class="title">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© <span class="emoji">ğŸ‡¸ğŸ‡¦</span></div>
        <div class="sub" id="calHijri">â€”</div>
        <div class="time" id="calClock">â€”</div>

        <hr class="sep">

        <div class="calGrid" id="calGrid"></div>

        <div class="footer">Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª: saudicalendars.com</div>
      </div>

    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHead">
        <div class="modalTitle" id="modalTitle">â€”</div>
        <button class="closeBtn" id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="modalBody" id="modalBody">
        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øªâ€¦</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© =====
    const TOTAL_PAGES = 604;
    let mode = "month"; // month | days

    // Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
    const YT_URL = "https://www.youtube.com/live/Cm1v4bteXbI?si=K5IIII-EJ8R4HQEb";

    // ===== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙØ­Ø§Øª =====
    function switchPage(){
      const val = document.getElementById("pageSelect").value;
      const quran = document.getElementById("quranPage");
      const cal = document.getElementById("calendarPage");
      if(val === "calendar"){
        quran.style.display = "none";
        cal.style.display = "block";
      }else{
        cal.style.display = "none";
        quran.style.display = "block";
      }
    }

    // ===== Ø§Ø³ØªØ®Ø±Ø§Ø¬ YouTube Video ID =====
    function extractYouTubeId(url){
      try{
        const u = new URL(url);
        const liveMatch = u.pathname.match(/\/live\/([^\/]+)/);
        if(liveMatch && liveMatch[1]) return liveMatch[1];

        const v = u.searchParams.get("v");
        if(v) return v;

        if(u.hostname.includes("youtu.be")){
          return u.pathname.replace("/","").trim();
        }
      }catch(e){}
      return null;
    }

    function setYouTubeEmbed(){
      const id = extractYouTubeId(YT_URL);
      const frame = document.getElementById("ytFrame");
      if(!id){
        frame.src = "about:blank";
        return;
      }
      frame.src = `https://www.youtube.com/embed/${id}`;
    }

    // ===== Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„ÙˆÙ‚Øª =====
    function getHijriText(now){
      try{
        return new Intl.DateTimeFormat("ar-SA-u-ca-islamic-umalqura", {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric"
        }).format(now);
      }catch(e){
        return new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric"
        }).format(now);
      }
    }

    function updateDateTime(){
      const now = new Date();

      const timeStr = new Intl.DateTimeFormat("ar-SA", {
        hour: "numeric",
        minute: "2-digit",
        second: "2-digit"
      }).format(now);

      const hijriText = getHijriText(now);

      // ØµÙØ­Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
      document.getElementById("clock").textContent = `â° ${timeStr}`;
      document.getElementById("hijriDate").textContent = `ğŸ“… ${hijriText}`;

      // ØµÙØ­Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
      document.getElementById("calClock").textContent = `â° ${timeStr}`;
      document.getElementById("calHijri").textContent = `ğŸ“… ${hijriText}`;
    }

    // ===== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©) =====
    function getHijriInfo(){
      const now = new Date();
      let formatter;
      try{
        formatter = new Intl.DateTimeFormat('en-TN-u-ca-islamic-umalqura', {
          day: 'numeric', month: 'numeric', year: 'numeric'
        });
      }catch(e){
        formatter = new Intl.DateTimeFormat('en-TN-u-ca-islamic', {
          day: 'numeric', month: 'numeric', year: 'numeric'
        });
      }

      const parts = formatter.formatToParts(now);
      const day = parseInt(parts.find(p => p.type === 'day')?.value || "NaN", 10);
      const month = parseInt(parts.find(p => p.type === 'month')?.value || "NaN", 10);
      const year = parseInt(parts.find(p => p.type === 'year')?.value || "NaN", 10);

      return { day, month, year, ok: Number.isFinite(day) && Number.isFinite(month) && Number.isFinite(year) };
    }

    // ØªÙ‚Ø¯ÙŠØ± Ø·ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø± 29/30 (Ø¨Ø¯ÙˆÙ† API Ø®Ø§Ø±Ø¬ÙŠ)
    function getHijriMonthLength(month){
      return (month % 2 === 1) ? 30 : 29;
    }

    function getDaysRemainingInHijriMonthInclusive(){
      const h = getHijriInfo();
      if(!h.ok) return null;

      const monthLen = getHijriMonthLength(h.month);
      const remaining = monthLen - h.day + 1; // Ø´Ø§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…
      if(!Number.isFinite(remaining) || remaining < 1) return null;
      return remaining;
    }

    // ===== Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… =====
    const DUAS = [
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø°ÙŠÙ† Ù‡Ù… Ø£Ù‡Ù„Ùƒ ÙˆØ®Ø§ØµØªÙƒØŒ ÙˆØ§Ø±ÙØ¹Ù†Ø§ Ø¨Ù‡ Ø¯Ø±Ø¬Ø§Øª.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§ÙØªØ­ Ù„Ù†Ø§ Ø£Ø¨ÙˆØ§Ø¨ Ø±Ø­Ù…ØªÙƒØŒ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ Ø°Ù†ÙˆØ¨Ù†Ø§ØŒ ÙˆØ§Ù‡Ø¯Ù†Ø§ Ù„Ø£Ø­Ø³Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.",
      "Ø§Ù„Ù„Ù‡Ù… Ø£Ø¹Ù†Ù‘Ø§ Ø¹Ù„Ù‰ Ø°ÙƒØ±Ùƒ ÙˆØ´ÙƒØ±Ùƒ ÙˆØ­Ø³Ù† Ø¹Ø¨Ø§Ø¯ØªÙƒ.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙÙŠ Ø§Ù„Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø¹Ù…Ù„ØŒ ÙˆØ«Ø¨Ù‘ØªÙ†Ø§ Ø¹Ù„Ù‰ Ø·Ø§Ø¹ØªÙƒ.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø±Ø¨ÙŠØ¹ Ù‚Ù„ÙˆØ¨Ù†Ø§ ÙˆÙ†ÙˆØ± ØµØ¯ÙˆØ±Ù†Ø§ ÙˆØ¬Ù„Ø§Ø¡ Ø£Ø­Ø²Ø§Ù†Ù†Ø§.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù„Ù†Ø§ Ù…Ù† ÙƒÙ„ Ù‡Ù…ÙÙ‘ ÙØ±Ø¬Ù‹Ø§ ÙˆÙ…Ù† ÙƒÙ„ Ø¶ÙŠÙ‚Ù Ù…Ø®Ø±Ø¬Ù‹Ø§.",
      "Ø§Ù„Ù„Ù‡Ù… ÙˆÙÙ‘Ù‚Ù†Ø§ Ù„Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ ÙˆØªÙ„Ø§ÙˆØ© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¢Ù†Ø§Ø¡ Ø§Ù„Ù„ÙŠÙ„ ÙˆØ£Ø·Ø±Ø§Ù Ø§Ù„Ù†Ù‡Ø§Ø±.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ Ø­Ø³Ù† Ø§Ù„Ø®Ø§ØªÙ…Ø© ÙˆØ§ØºÙØ± Ù„Ù†Ø§ ÙˆÙ„ÙˆØ§Ù„Ø¯ÙŠÙ†Ø§ ÙˆÙ„Ù„Ù…Ø³Ù„Ù…ÙŠÙ†."
    ];

    function dayKeyLocal(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const da = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${da}`;
    }

    function updateDailyDua(){
      const key = dayKeyLocal();
      let h = 0;
      for (let i=0;i<key.length;i++) h = (h*31 + key.charCodeAt(i)) >>> 0;
      const idx = h % DUAS.length;
      document.getElementById("duaText").textContent = DUAS[idx];
    }

    // ===== UI Ù„Ù„Ù…ÙˆØ¯ =====
    function setMode(m){
      mode = m;
      refreshModeUI();
    }

    function refreshModeUI(){
      const rowMonth = document.getElementById("rowMonth");
      const rowDays = document.getElementById("rowDays");
      rowMonth.classList.toggle("active", mode === "month");
      rowDays.classList.toggle("active", mode === "days");

      const sel = document.getElementById("daysSelect");
      sel.disabled = (mode !== "days");
      sel.style.opacity = (mode !== "days") ? "0.5" : "1";
    }

    // ===== Ø§Ù„Ø­Ø³Ø§Ø¨ =====
    function calculatePlan(){
      const current = parseInt(document.getElementById("currentPage").value, 10);

      if(!Number.isFinite(current) || current < 1 || current > TOTAL_PAGES){
        document.getElementById("result").innerHTML =
          "âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµÙØ­Ø© ØµØ­ÙŠØ­ Ø¨ÙŠÙ† <b>1</b> Ùˆ <b>604</b>.";
        return;
      }

      const remainingPages = TOTAL_PAGES - current;

      let days = null;
      if(mode === "days"){
        days = parseInt(document.getElementById("daysSelect").value, 10);
      }else{
        days = getDaysRemainingInHijriMonthInclusive();
      }

      if(!Number.isFinite(days) || days === null || days < 1){
        document.getElementById("result").innerHTML =
          "âš ï¸ ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².<br><span style='font-size:16px;color:rgba(255,255,255,.55)'>Ø§Ø®ØªØ± (Ø­Ø³Ø¨ Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…) ÙƒØ­Ù„ Ø¨Ø¯ÙŠÙ„.</span>";
        return;
      }

      const perDay = Math.ceil(remainingPages / days);
      const daysLabel = (mode === "days")
        ? `Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: <b>${days}</b>`
        : `Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: <b>${days}</b> (Ù‡Ø¬Ø±ÙŠ)`;

      document.getElementById("result").innerHTML = `
        <div>ğŸ“˜ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <b>${remainingPages}</b></div>
        <div>ğŸ“… ${daysLabel}</div>
        <div>ğŸ“– Ø§Ù‚Ø±Ø£ ÙŠÙˆÙ…ÙŠÙ‹Ø§: <b>${perDay}</b> ØµÙØ­Ø©</div>
        <div>âœ… Ù„ØªØ®ØªÙ… Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¯Ø©</div>
      `;
    }

    // =========================
    // ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (Ø¨Ø·Ø§Ù‚Ø§Øª + ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
    // =========================

    const CAL_SECTIONS = [
      {
        key: "academic",
        title: "Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ",
        icon: "ğŸ“",
        cls: "tileBlue",
        url: "https://saudicalendars.com/academic-calendar/"
      },
      {
        key: "salaries",
        title: "Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø±ÙˆØ§ØªØ¨",
        icon: "ğŸ’°",
        cls: "tileGreen",
        url: "https://saudicalendars.com/salaries-dates/"
      },
      {
        key: "citizen",
        title: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø·Ù†",
        icon: "ğŸ‘¤",
        cls: "tileTeal",
        url: "https://saudicalendars.com/citizen-account/"
      },
      {
        key: "retirees",
        title: "Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ØªÙ‚Ø§Ø¹Ø¯ÙŠÙ†",
        icon: "ğŸ§“",
        cls: "tileGold",
        url: "https://saudicalendars.com/retirees-salaries/"
      },
      {
        key: "social",
        title: "Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ",
        icon: "ğŸ›¡ï¸",
        cls: "tileGold",
        url: "https://saudicalendars.com/deposit-social-security/"
      },
      {
        key: "convert",
        title: "ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®",
        icon: "ğŸ”",
        cls: "tileBlue",
        url: "https://saudicalendars.com/date-converter/"
      }
    ];

    function renderCalendarTiles(){
      const grid = document.getElementById("calGrid");
      grid.innerHTML = "";
      CAL_SECTIONS.forEach(sec=>{
        const tile = document.createElement("div");
        tile.className = `calTile ${sec.cls}`;
        tile.innerHTML = `
          <div class="tTitle">
            <span class="tIcon">${sec.icon}</span>
            ${sec.title}
          </div>
        `;
        tile.addEventListener("click", ()=>openSection(sec));
        grid.appendChild(tile);
      });
    }

    const modalOverlay = document.getElementById("modalOverlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");

    function openModal(){
      modalOverlay.style.display = "flex";
    }
    function closeModal(){
      modalOverlay.style.display = "none";
    }
    document.getElementById("closeBtn").addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e)=>{
      if(e.target === modalOverlay) closeModal();
    });

    // Ø¬Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† ÙØªØ­Ù‡Ø§ (CORS) Ø¹Ø¨Ø± allorigins
    async function fetchHtml(url){
      const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);
      const res = await fetch(proxy, { cache: "no-store" });
      if(!res.ok) throw new Error("Fetch failed");
      return await res.text();
    }

    function parseEventsFromSaudiCalendars(html, limit = 8){
      const doc = new DOMParser().parseFromString(html, "text/html");
      const anchors = Array.from(doc.querySelectorAll("a"));

      // Ù†Ù„ØªÙ‚Ø· Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ ØªØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠ/Ù…ÙŠÙ„Ø§Ø¯ÙŠ
      const items = [];
      for(const a of anchors){
        const t = (a.textContent || "").replace(/\s+/g, " ").trim();
        if(!t) continue;

        // Ø£ØºÙ„Ø¨ ØµÙØ­Ø§ØªÙ‡Ù… ÙÙŠÙ‡Ø§: 144x/... Ù‡Ù€ - 202x/... Ù…
        const hasHijri = t.includes("Ù‡Ù€");
        const hasGreg = t.includes("Ù…");
        if(!hasHijri || !hasGreg) continue;

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‡Ø¬Ø±ÙŠ/Ù…ÙŠÙ„Ø§Ø¯ÙŠ
        const hijriMatch = t.match(/(\d{4}\/\d{1,2}\/\d{1,2})\s*Ù‡Ù€/);
        const gregMatch  = t.match(/(\d{4}\/\d{1,2}\/\d{1,2})\s*Ù…/);

        // Ø¹Ù†ÙˆØ§Ù† Ù…Ø®ØªØµØ±: Ù†Ø­Ø§ÙˆÙ„ Ù†Ø§Ø®Ø° Ø£ÙˆÙ„ Ø¬Ø²Ø¡ Ù‚Ø¨Ù„ "144"
        let title = t;
        const idx144 = t.indexOf("144");
        if(idx144 > 0) title = t.slice(0, idx144).trim();

        // Ù†Ø¸Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø´ÙˆÙŠ
        title = title.replace(/Ø·ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…/g, "").replace(/Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ\s*:\s*$/g, "").trim();

        items.push({
          title,
          hijri: hijriMatch ? hijriMatch[1] : null,
          greg: gregMatch ? gregMatch[1] : null,
          raw: t
        });

        if(items.length >= limit) break;
      }

      // Ø¥Ø°Ø§ Ù…Ø§ Ù†Ø¬Ø­ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ø£ÙŠ Ø³Ø¨Ø¨
      if(items.length === 0){
        return [{ title: "ØªØ¹Ø°Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø©.", hijri: null, greg: null, raw: "" }];
      }
      return items;
    }

    async function openSection(sec){
      modalTitle.textContent = `${sec.icon} ${sec.title}`;
      modalBody.innerHTML = `<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øªâ€¦</div>`;
      openModal();

      try{
        const html = await fetchHtml(sec.url);
        const events = parseEventsFromSaudiCalendars(html, 10);

        modalBody.innerHTML = events.map(ev=>{
          const main = ev.title || "â€”";
          const h = ev.hijri ? `ğŸ“… Ù‡Ø¬Ø±ÙŠ: ${ev.hijri}` : "";
          const g = ev.greg ? `ğŸ—“ï¸ Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${ev.greg}` : "";
          const sub = [h,g].filter(Boolean).join(" â€¢ ");
          return `
            <div class="infoLine">
              ${main}
              ${sub ? `<small>${sub}</small>` : ""}
            </div>
          `;
        }).join("") + `<div class="hint">ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† ÙØªØ­ ØµÙØ­Ø© Ø®Ø§Ø±Ø¬ÙŠØ©.</div>`;
      }catch(err){
        modalBody.innerHTML = `
          <div class="infoLine">
            âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†.
            <small>Ø¥Ø°Ø§ ØªÙƒØ±Ø±ØŒ Ù‚Ù„Ù‘ÙŠ ÙˆØ´ Ø¬Ù‡Ø§Ø²Ùƒ/Ø§Ù„Ù…ØªØµÙØ­ (Ù‚Ø¯ ÙŠØ­Ø¸Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ).</small>
          </div>
        `;
      }
    }

    // ===== Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« =====
    document.getElementById("pageSelect").addEventListener("change", switchPage);

    document.getElementById("rowMonth").addEventListener("click", ()=>setMode("month"));
    document.getElementById("rowDays").addEventListener("click", ()=>setMode("days"));
    document.getElementById("daysSelect").addEventListener("change", refreshModeUI);

    document.getElementById("calcBtn").addEventListener("click", calculatePlan);
    document.getElementById("currentPage").addEventListener("keydown", (e)=>{
      if(e.key === "Enter") calculatePlan();
    });

    // ===== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ =====
    renderCalendarTiles();
    refreshModeUI();
    switchPage();
    updateDateTime();
    updateDailyDua();
    setYouTubeEmbed();

    setInterval(updateDateTime, 1000);
    setInterval(updateDailyDua, 60 * 1000);
  </script>
</body>
</html>
