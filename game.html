<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ù„Ø¹Ø¨Ø© Ø±Ù…Ø¶Ø§Ù†ÙŠØ© 3D</title>
  <style>
    :root{
      --bg0:#070913;
      --bg1:#0b1230;
      --glass: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.14);
      --text:#fff;
      --muted: rgba(255,255,255,.78);
      --gold1:#ffe6ad;
      --gold2:#ffbf57;
      --blue1:#4d79ff;
      --blue2:#2b55ff;
      --shadow: 0 26px 80px rgba(0,0,0,.55);
      --r: 28px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(900px 600px at 50% -200px, rgba(255,191,85,.14), transparent 65%),
                  radial-gradient(900px 600px at 20% 20%, rgba(77,121,255,.14), transparent 65%),
                  radial-gradient(900px 600px at 80% 40%, rgba(77,121,255,.10), transparent 65%),
                  linear-gradient(180deg, var(--bg1), var(--bg0));
      color:var(--text);
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* Canvas Ø§Ù„Ù„Ø¹Ø¨Ø© */
    #game{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      display:block;
      background: transparent;
    }

    /* Ø·Ø¨Ù‚Ø© ÙˆØ§Ø¬Ù‡Ø© */
    .ui{
      position:fixed;
      inset: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
      pointer-events:none;
      display:flex;
      justify-content:center;
      padding: 18px 14px 18px;
    }

    .panel{
      pointer-events:auto;
      width:min(720px, 95vw);
      border-radius: 34px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      overflow:hidden;
      position:relative;
    }

    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(650px 220px at 50% 0%, rgba(255,191,85,.18), transparent 70%),
                  radial-gradient(500px 240px at 20% 30%, rgba(77,121,255,.16), transparent 70%),
                  radial-gradient(500px 240px at 80% 40%, rgba(77,121,255,.12), transparent 70%);
      opacity:.9;
      pointer-events:none;
    }

    .top{
      position:relative;
      padding: 18px 18px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 1000;
      font-size: 20px;
      letter-spacing:.2px;
    }
    .title .badge{
      padding: 8px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,228,173,.35), rgba(255,191,85,.16));
      border:1px solid rgba(255,228,173,.35);
      color: rgba(255,255,255,.92);
      box-shadow: 0 14px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.10);
      font-size: 13px;
      font-weight: 900;
      white-space:nowrap;
    }

    .btnRow{
      position:relative;
      display:flex;
      gap:10px;
      align-items:center;
    }

    .btn{
      pointer-events:auto;
      border:0;
      padding: 10px 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--blue1), var(--blue2));
      color:#fff;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 18px 40px rgba(43,85,255,.28), 0 16px 30px rgba(0,0,0,.25),
                  inset 0 1px 0 rgba(255,255,255,.12), inset 0 -10px 18px rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
    }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      background: linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      box-shadow: 0 18px 40px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.10);
    }

    .mid{
      position:relative;
      padding: 12px 18px 18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:stretch;
    }

    .card{
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 16px 34px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.10);
      padding: 12px 12px;
      min-height: 86px;
    }
    .label{
      color: rgba(255,255,255,.78);
      font-weight: 900;
      font-size: 13px;
      margin-bottom: 6px;
    }
    .big{
      font-weight: 1100;
      font-size: 24px;
      line-height:1.1;
    }
    .hint{
      margin-top: 4px;
      color: rgba(255,255,255,.65);
      font-size: 12.5px;
      font-weight: 800;
    }

    .footer{
      position:relative;
      padding: 0 18px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,.65);
      font-weight: 900;
      font-size: 12.5px;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom: 22px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      color:#fff;
      padding: 10px 14px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 20px 50px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      font-weight: 900;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-4px);
    }

    @media (max-width:520px){
      .mid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<div class="ui">
  <div class="panel" id="panel">
    <div class="top">
      <div class="title">
        ğŸ•Œ <span>Ù„Ø¹Ø¨Ø© Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</span>
        <span class="badge">Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ø¬ÙˆÙ… âœ¨</span>
      </div>
      <div class="btnRow">
        <button class="btn secondary" onclick="goBack()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
        <button class="btn" onclick="resetGame()">ğŸ”„ ØªØµÙÙŠØ±</button>
      </div>
    </div>

    <div class="mid">
      <div class="card">
        <div class="label">Ø§Ù„Ù…Ù‡Ù…Ø©</div>
        <div class="big">Ø§Ù„ØªÙ‚Ø· Ø§Ù„Ù†Ø¬Ù…Ø© Ù‚Ø¨Ù„ Ø£Ù† ØªØ®ØªÙÙŠ â­</div>
        <div class="hint">Ø¨Ø§Ù„Ø¬ÙˆØ§Ù„: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¬Ù…Ø© â€” Ø¨Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: Ø§Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§</div>
      </div>

      <div class="card">
        <div class="label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
        <div class="big"><span id="score">0</span></div>
        <div class="hint">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©: <span id="best">0</span></div>
      </div>
    </div>

    <div class="footer">
      <div>Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ø¶ØºØ· <b>Space</b> Ù„ØªÙØ¹ÙŠÙ„ â€œÙˆÙ…ÙŠØ¶â€ âœ¨</div>
      <div id="status">Ø¬Ø§Ù‡Ø² âœ…</div>
    </div>
  </div>
</div>

<div class="toast" id="toast">Ø£Ø­Ø³Ù†Øª! âœ¨</div>

<script>
  // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© =====
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  const scoreEl = document.getElementById("score");
  const bestEl  = document.getElementById("best");
  const statusEl= document.getElementById("status");
  const toast   = document.getElementById("toast");

  let W=0, H=0, DPR=1;
  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(window.innerWidth);
    H = Math.floor(window.innerHeight);
    canvas.width  = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width  = W+"px";
    canvas.style.height = H+"px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  // ===== Ø®Ù„ÙÙŠØ© Ù†Ø¬ÙˆÙ… Ù…ØªØ­Ø±ÙƒØ© (Ø¨Ø§Ø±Ø§Ù„Ø§ÙƒØ³) =====
  const dust = [];
  function seedDust(){
    dust.length = 0;
    const n = Math.floor((W*H) / 18000);
    for(let i=0;i<n;i++){
      dust.push({
        x: Math.random()*W,
        y: Math.random()*H,
        r: 0.6 + Math.random()*1.8,
        a: 0.18 + Math.random()*0.35,
        s: 0.10 + Math.random()*0.35
      });
    }
  }
  seedDust();

  // ===== Ù†Ø¬Ù…Ø© Ø§Ù„Ù‡Ø¯Ù =====
  let score = 0;
  let best = Number(localStorage.getItem("ramadan_best") || 0);
  bestEl.textContent = best;

  let blink = false;

  const star = {
    x: W*0.5,
    y: H*0.62,
    r: 18,
    born: 0,
    life: 2600, // ms
    vx: 0,
    vy: 0,
    alive: true
  };

  function spawnStar(){
    const safeTop = 170; // Ø¹Ø´Ø§Ù† Ù…Ø§ ØªØ·Ù„Ø¹ ØªØ­Øª Ø§Ù„Ù„ÙˆØ­Ø©
    const safeBottom = 90;
    star.x = 60 + Math.random()*(W-120);
    star.y = safeTop + Math.random()*(H - safeTop - safeBottom);
    star.r = 16 + Math.random()*10;
    star.born = performance.now();
    star.life = 2200 + Math.random()*2200;
    star.vx = (-0.35 + Math.random()*0.7);
    star.vy = (-0.25 + Math.random()*0.5);
    star.alive = true;
    statusEl.textContent = "Ø§Ù„Ù†Ø¬Ù…Ø© Ø¸Ù‡Ø±Øª â­";
  }
  spawnStar();

  // ===== Ù…Ø¤Ø«Ø±Ø§Øª (Ø´Ø±Ø±/ÙˆÙ…ÙŠØ¶) =====
  const sparks = [];
  function addSparks(x,y){
    for(let i=0;i<22;i++){
      sparks.push({
        x,y,
        vx:(-2.2+Math.random()*4.4),
        vy:(-2.2+Math.random()*4.4),
        r: 1.2 + Math.random()*2.2,
        a: 1,
        da: 0.02 + Math.random()*0.04
      });
    }
  }

  function showToast(txt){
    toast.textContent = txt;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"), 700);
  }

  // ===== Ø±Ø³Ù… Ø§Ù„Ù†Ø¬Ù…Ø© (Ø´ÙƒÙ„ 3D) =====
  function drawStar3D(x,y,r,t){
    // Ù‡Ø§Ù„Ø© Ø°Ù‡Ø¨ÙŠØ©
    const glow = ctx.createRadialGradient(x,y,0,x,y,r*3.2);
    glow.addColorStop(0, `rgba(255,191,85,${0.40 + 0.15*Math.sin(t*0.008)})`);
    glow.addColorStop(1, `rgba(255,191,85,0)`);
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(x,y,r*3.0,0,Math.PI*2);
    ctx.fill();

    // Ø¬Ø³Ù… Ø§Ù„Ù†Ø¬Ù…Ø©
    const g = ctx.createLinearGradient(x-r,y-r,x+r,y+r);
    g.addColorStop(0, "rgba(255,230,173,0.95)");
    g.addColorStop(0.5, "rgba(255,191,85,0.95)");
    g.addColorStop(1, "rgba(184,122,37,0.92)");
    ctx.fillStyle = g;

    ctx.beginPath();
    const spikes = 5;
    let rot = Math.PI/2 * 3;
    let step = Math.PI / spikes;
    let outer = r;
    let inner = r*0.48;
    ctx.moveTo(x, y - outer);
    for (let i=0;i<spikes;i++){
      ctx.lineTo(x + Math.cos(rot) * outer, y + Math.sin(rot) * outer);
      rot += step;
      ctx.lineTo(x + Math.cos(rot) * inner, y + Math.sin(rot) * inner);
      rot += step;
    }
    ctx.closePath();
    ctx.fill();

    // Ù„Ù…Ø¹Ø§Ù† 3D
    ctx.strokeStyle = "rgba(255,255,255,.35)";
    ctx.lineWidth = 1.2;
    ctx.stroke();

    // Ù†Ù‚Ø·Ø© Ù„Ù…Ø¹Ø§Ù†
    ctx.fillStyle = "rgba(255,255,255,.55)";
    ctx.beginPath();
    ctx.arc(x-r*0.25, y-r*0.35, r*0.22, 0, Math.PI*2);
    ctx.fill();
  }

  // ===== ØªØ­Ø¯ÙŠØ« ÙˆØ±Ø³Ù… =====
  function loop(t){
    // Ù…Ø³Ø­ + Ø®Ù„ÙÙŠØ© Ø¶Ø¨Ø§Ø¨ÙŠØ© Ø®ÙÙŠÙØ©
    ctx.clearRect(0,0,W,H);

    // ØºØ¨Ø§Ø± Ø§Ù„Ù†Ø¬ÙˆÙ… Ø¨Ø§Ù„Ø®Ù„Ù
    for(const p of dust){
      p.y += p.s;
      if(p.y > H+10){ p.y = -10; p.x = Math.random()*W; }
      ctx.fillStyle = `rgba(255,255,255,${p.a})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    }

    // â€œÙˆÙ…ÙŠØ¶â€ Ø§Ø®ØªÙŠØ§Ø±ÙŠ
    if(blink){
      ctx.fillStyle = "rgba(255,191,85,.04)";
      ctx.fillRect(0,0,W,H);
    }

    // Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ù…Ø© ÙˆØ¹Ù…Ø±Ù‡Ø§
    if(star.alive){
      star.x += star.vx;
      star.y += star.vy;

      // Ø§Ø±ØªØ¯Ø§Ø¯ Ø®ÙÙŠÙ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Ø´Ø©
      if(star.x < 30 || star.x > W-30) star.vx *= -1;
      if(star.y < 140 || star.y > H-60) star.vy *= -1;

      // Ù…Ø¤Ø´Ø± Ø¹Ù…Ø±
      const age = t - star.born;
      const left = 1 - (age / star.life);
      if(left <= 0){
        star.alive = false;
        statusEl.textContent = "ÙØ§ØªØªÙƒ! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ğŸ˜…";
        setTimeout(spawnStar, 650);
      }else{
        // Ø±Ø³Ù… Ø§Ù„Ù†Ø¬Ù…Ø©
        drawStar3D(star.x, star.y, star.r*(0.92 + 0.08*Math.sin(t*0.012)), t);

        // Ø­Ù„Ù‚Ø© Ø²Ù…Ù†ÙŠØ© Ø­ÙˆÙ„Ù‡Ø§
        ctx.strokeStyle = `rgba(255,255,255,${0.22 + 0.18*Math.sin(t*0.01)})`;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.r*2.0, -Math.PI/2, (-Math.PI/2) + (Math.PI*2*left));
        ctx.stroke();
      }
    }

    // Ø§Ù„Ø´Ø±Ø±
    for(let i=sparks.length-1;i>=0;i--){
      const s = sparks[i];
      s.x += s.vx;
      s.y += s.vy;
      s.vx *= 0.98;
      s.vy *= 0.98;
      s.a -= s.da;
      if(s.a <= 0){ sparks.splice(i,1); continue; }
      ctx.fillStyle = `rgba(255,191,85,${s.a})`;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // ===== Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù†Ù‚Ø±/Ø§Ù„Ù„Ù…Ø³ =====
  function hitTest(x,y){
    const dx = x - star.x;
    const dy = y - star.y;
    return (dx*dx + dy*dy) <= (star.r*star.r*4.0);
  }

  function handleTap(clientX, clientY){
    const x = clientX;
    const y = clientY;

    if(star.alive && hitTest(x,y)){
      star.alive = false;
      score++;
      scoreEl.textContent = score;
      addSparks(star.x, star.y);
      statusEl.textContent = "Ø§Ù„ØªÙ‚Ø·ØªÙ‡Ø§! âœ¨";
      showToast("Ø£Ø­Ø³Ù†Øª! +1 â­");

      if(score > best){
        best = score;
        localStorage.setItem("ramadan_best", best);
        bestEl.textContent = best;
        showToast("Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯! ğŸ†");
      }
      setTimeout(spawnStar, 480);
    }
  }

  // Ù„Ù…Ø³ Ù„Ù„Ø¬ÙˆØ§Ù„
  window.addEventListener("touchstart", (e)=>{
    const t = e.touches[0];
    handleTap(t.clientX, t.clientY);
  }, {passive:true});

  // Ù…Ø§ÙˆØ³ Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
  window.addEventListener("mousedown", (e)=>{
    handleTap(e.clientX, e.clientY);
  });

  // Space Ù„Ù„ÙˆÙ…ÙŠØ¶
  window.addEventListener("keydown", (e)=>{
    if(e.code === "Space"){
      blink = !blink;
      statusEl.textContent = blink ? "Ø§Ù„ÙˆÙ…ÙŠØ¶ Ø´ØºØ§Ù„ âœ¨" : "Ø§Ù„ÙˆÙ…ÙŠØ¶ Ù…Ø·ÙÙŠ âœ…";
    }
  });

  // Ø£Ø²Ø±Ø§Ø±
  window.resetGame = function(){
    score = 0;
    scoreEl.textContent = score;
    sparks.length = 0;
    spawnStar();
    showToast("ØªÙ… Ø§Ù„ØªØµÙÙŠØ± âœ…");
  }

  window.goBack = function(){
    // ÙŠØ±Ø¬Ø¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    window.location.href = "index.html";
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØºØ¨Ø§Ø± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø³
  window.addEventListener("resize", ()=>{
    seedDust();
  });
</script>

</body>
</html>
