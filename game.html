<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Football Runner â€” Ù„Ø¹Ø¨Ø© ÙƒØ±Ø© Ù‚Ø¯Ù…</title>
  <style>
    :root{
      --bg0:#05070d; --bg1:#0b1330;
      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text:#fff; --muted: rgba(255,255,255,.75);
      --blueA:#4d79ff; --blueB:#2b55ff;
      --goldA:#ffe6b0; --goldB:#ffbf55;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; height:100vh; overflow:hidden; color:var(--text);
      font-family: system-ui,-apple-system,"Segoe UI",Tahoma,Arial,sans-serif;
      background:
        radial-gradient(1100px 650px at 50% -140px, rgba(255,191,85,.10), transparent 60%),
        radial-gradient(900px 520px at 22% 20%, rgba(77,121,255,.18), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
    }

    canvas{position:fixed; inset:0; display:block;}

    /* HUD */
    .hud{
      position:fixed; top:12px; left:12px; right:12px; z-index:10;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      pointer-events:none;
    }
    .pill{
      pointer-events:auto;
      display:flex; gap:10px; align-items:center;
      padding:10px 12px; border-radius:999px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      font-weight: 900; font-size: 13px; color: rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .btn{
      pointer-events:auto; border:0; cursor:pointer;
      padding:10px 12px; border-radius:999px;
      background: linear-gradient(135deg, var(--blueA), var(--blueB));
      color:#fff; font-weight: 1000; box-shadow: 0 14px 35px rgba(43,85,255,.25), var(--shadow);
    }
    .btn:active{transform:translateY(1px)}
    .hint{
      position:fixed; bottom:12px; left:12px; right:12px;
      display:flex; justify-content:center; z-index:10;
      pointer-events:none;
    }
    .hint .card{
      pointer-events:auto;
      width:min(860px, 100%);
      padding:12px 14px; border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow); backdrop-filter: blur(12px);
      color: var(--muted); font-weight: 900; text-align:center;
    }

    /* Overlays */
    .overlay{
      position:fixed; inset:0; display:none; place-items:center; z-index:30;
      background: rgba(0,0,0,.45); backdrop-filter: blur(8px);
    }
    .overlay.show{display:grid}
    .panel{
      width:min(980px, 92%);
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 26px 90px rgba(0,0,0,.65);
      padding: 16px;
    }
    .panel h2{margin:8px 0 10px; font-size: 20px;}
    .grid{
      display:grid; gap:10px;
      grid-template-columns: 1fr;
    }
    @media (min-width:900px){
      .grid{grid-template-columns: 1.2fr 1fr;}
    }

    .box{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 12px;
    }
    label{display:block; font-weight: 900; color: rgba(255,255,255,.85); margin: 8px 0 6px;}
    select, input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color:#fff; font-weight: 900;
      outline:none;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .mini{
      font-size: 12px; color: rgba(255,255,255,.70); font-weight: 800;
      margin-top: 6px;
    }
    .list{
      display:grid; gap:10px; margin-top: 8px;
    }
    .item{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding: 10px 12px; border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .tag{
      padding: 6px 10px; border-radius:999px;
      background: rgba(255,191,85,.16);
      border:1px solid rgba(255,191,85,.22);
      font-weight: 1000; font-size: 12px; color: rgba(255,255,255,.92);
      white-space:nowrap;
    }
    .danger{ background: rgba(255,70,70,.16); border-color: rgba(255,70,70,.25); }
    .ok{ background: rgba(70,255,170,.14); border-color: rgba(70,255,170,.25); }

    .cta{
      display:flex; gap:10px; justify-content:center; margin-top: 10px; flex-wrap:wrap;
    }
  </style>
</head>
<body>

<canvas id="cv"></canvas>

<div class="hud">
  <div class="pill">âš½ <span id="clubName">â€”</span> â€¢ <span id="leagueName">â€”</span></div>
  <div class="pill">â­ Ù†Ù‚Ø§Ø·: <span id="score">0</span> â€¢ ğŸ’¨ Ø³Ø±Ø¹Ø©: <span id="spd">1.0</span>x â€¢ â¤ï¸ <span id="hp">3</span></div>
  <div style="display:flex; gap:10px;">
    <button class="btn" id="btnMarket">Ø³ÙˆÙ‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</button>
    <button class="btn" id="btnSettings">Ø§Ø®ØªÙŠØ§Ø± ÙØ±ÙŠÙ‚</button>
    <button class="btn" id="btnRestart">Ø¥Ø¹Ø§Ø¯Ø©</button>
  </div>
</div>

<div class="hint">
  <div class="card">
    ğŸ“± Ø§Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± â€¢ Ø§Ø³Ø­Ø¨ Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ù‚ÙØ² â€¢ ğŸ–¥ï¸ Ø§Ù„Ø£Ø³Ù‡Ù… â† â†’ Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ùˆ â†‘ Ù„Ù„Ù‚ÙØ²
  </div>
</div>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆØ±ÙŠ/ÙØ±ÙŠÙ‚ -->
<div class="overlay show" id="settings">
  <div class="panel">
    <h2>âš½ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
    <div class="grid">
      <div class="box">
        <label>Ø§Ù„Ø¯ÙˆØ±ÙŠ</label>
        <select id="leagueSelect"></select>

        <label>Ø§Ù„ÙØ±ÙŠÙ‚</label>
        <select id="clubSelect"></select>

        <label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="playerName" placeholder="Ù…Ø«Ø§Ù„: ÙŠØ§Ø³Ø±" />

        <div class="mini">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Offline. ØªÙ‚Ø¯Ø± ØªÙˆØ³Ù‘Ø¹ Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª/Ø§Ù„ÙØ±Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</div>
      </div>

      <div class="box">
        <div class="row">
          <div class="tag ok">ğŸ® Ù†Ù…Ø· ÙˆØ§Ù‚Ø¹ÙŠ</div>
          <div class="tag">3 Ù…Ø³Ø§Ø±Ø§Øª + Ù‚ÙØ² + Ù…Ø±Ø§ÙˆØºØ©</div>
          <div class="tag danger">ğŸ›¡ï¸ Ø¹ÙˆØ§Ø¦Ù‚: Ù…Ø¯Ø§ÙØ¹ÙŠÙ†/Ø­ÙƒÙ…/Ø´Ø±Ø·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
        </div>
        <div class="mini" style="margin-top:10px;">
          Ø§Ù„Ù‡Ø¯Ù: Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ø¬ÙˆÙ…/Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙˆØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ø¯Ø§ÙØ¹ÙŠÙ†. Ø§Ù„Ø³Ø±Ø¹Ø© ØªØ²ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
        </div>

        <div class="cta">
          <button class="btn" id="startGame">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ø³ÙˆÙ‚ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª -->
<div class="overlay" id="market">
  <div class="panel">
    <h2>ğŸ§¾ Ø³ÙˆÙ‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª (Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ø¯ÙŠØ«)</h2>
    <div class="grid">
      <div class="box">
        <div class="row">
          <div class="tag">ğŸ‘¤ Ù„Ø§Ø¹Ø¨Ùƒ: <span id="pName">â€”</span></div>
          <div class="tag">ğŸ’° Ø±ØµÙŠØ¯: <span id="coins">0</span></div>
          <div class="tag">â­ Ù†Ù‚Ø§Ø·Ùƒ: <span id="score2">0</span></div>
        </div>

        <div class="mini">ÙƒÙ„ ØµÙÙ‚Ø© ØªØ²ÙŠØ¯ Ù…Ù‡Ø§Ø±Ø©/Ø³Ø±Ø¹Ø©/Ø­Ø¸. (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© â€” ØªÙ‚Ø¯Ø± ØªØ³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù€ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ù† Ù…Ù„Ù JSON Ù„Ø§Ø­Ù‚Ù‹Ø§.)</div>

        <div class="list" id="transferList"></div>
      </div>

      <div class="box">
        <h2 style="margin:0 0 8px">ğŸ“Œ ÙƒÙŠÙ Ù†Ø®Ù„ÙŠÙ‡Ø§ â€œØ§Ù†ØªÙ‚Ø§Ù„Ø§Øª ÙˆØ§Ù‚Ø¹ÙŠØ©â€ØŸ</h2>
        <div class="mini">
          ØªØ­ØªØ§Ø¬ Ù…ØµØ¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª: API Ù„ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… Ø£Ùˆ Ù…Ù„Ù JSON ØªØ­Ø¯Ø«Ù‡ Ø£Ù†Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§.
          Ø¥Ø°Ø§ ØªØ¨ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù†Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ API (Ø¢Ù…Ù†) Ø£Ø¹Ø·ÙŠÙƒ Ø·Ø±ÙŠÙ‚Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©.
        </div>
        <div class="cta">
          <button class="btn" id="closeMarket">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ====== Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙˆØ±ÙŠØ§Øª/ÙØ±Ù‚ (ØªÙ‚Ø¯Ø± ØªÙˆØ³Ù‘Ø¹Ù‡Ø§) ======
  const LEAGUES = [
    { id:"SPL", name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ", clubs:["Ø§Ù„Ù‡Ù„Ø§Ù„","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ø§ØªØ­Ø§Ø¯","Ø§Ù„Ø£Ù‡Ù„ÙŠ","Ø§Ù„Ø´Ø¨Ø§Ø¨","Ø§Ù„Ø§ØªÙØ§Ù‚"] },
    { id:"EPL", name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", clubs:["Manchester City","Liverpool","Arsenal","Chelsea","Manchester United","Tottenham"] },
    { id:"LL",  name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠ", clubs:["Real Madrid","Barcelona","Atletico Madrid","Sevilla","Real Sociedad"] },
    { id:"SA",  name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠ", clubs:["Inter","AC Milan","Juventus","Napoli","Roma"] },
    { id:"BL",  name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠ", clubs:["Bayern","Dortmund","Leverkusen","RB Leipzig"] },
    { id:"L1",  name:"Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ", clubs:["PSG","Marseille","Lyon","Monaco","Lille"] },
  ];

  // Ø³ÙˆÙ‚ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª (ØªØ¬Ø±ÙŠØ¨ÙŠ) â€” Ù„Ø§Ø­Ù‚Ù‹Ø§ ØªØ³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©
  const TRANSFERS = [
    { id:1, title:"ØµÙÙ‚Ø© Ø¬Ù†Ø§Ø­ Ø³Ø±ÙŠØ¹", from:"Free Agent", to:"ÙØ±ÙŠÙ‚Ùƒ", fee:120, bonus:{ speed:+0.08, luck:+0.06 }, type:"ØªØ¹Ø§Ù‚Ø¯" },
    { id:2, title:"Ù…Ø¯Ø±Ø¨ Ù„ÙŠØ§Ù‚Ø©", from:"Staff", to:"ÙØ±ÙŠÙ‚Ùƒ", fee:80,  bonus:{ stamina:+1 }, type:"Ø·Ø§Ù‚Ù…" },
    { id:3, title:"Ø­Ø°Ø§Ø¡ Ø§Ø­ØªØ±Ø§ÙÙŠ", from:"Sponsor", to:"ÙØ±ÙŠÙ‚Ùƒ", fee:60,  bonus:{ jump:+0.10 }, type:"Ù…Ø¹Ø¯Ø§Øª" },
    { id:4, title:"Ù…Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¡", from:"Club", to:"ÙØ±ÙŠÙ‚Ùƒ", fee:140, bonus:{ shield:+1 }, type:"Ø·Ø§Ù‚Ù…" },
    { id:5, title:"ØµÙÙ‚Ø© Ù…Ù‡Ø§Ø¬Ù… Ù‡Ø¯Ø§Ù", from:"Transfer", to:"ÙØ±ÙŠÙ‚Ùƒ", fee:200, bonus:{ speed:+0.10, luck:+0.10 }, type:"ØªØ¹Ø§Ù‚Ø¯" },
  ];

  // ====== DOM ======
  const $ = (id)=>document.getElementById(id);
  const settings = $("settings");
  const market = $("market");
  const leagueSelect = $("leagueSelect");
  const clubSelect = $("clubSelect");
  const playerName = $("playerName");
  const startGame = $("startGame");
  const btnSettings = $("btnSettings");
  const btnRestart  = $("btnRestart");
  const btnMarket   = $("btnMarket");
  const closeMarket = $("closeMarket");

  const clubNameEl  = $("clubName");
  const leagueNameEl= $("leagueName");
  const scoreEl     = $("score");
  const spdEl       = $("spd");
  const hpEl        = $("hp");

  const pNameEl     = $("pName");
  const coinsEl     = $("coins");
  const score2El    = $("score2");
  const transferList= $("transferList");

  // ====== Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨/Ø§Ù„Ù„Ø¹Ø¨Ø© ======
  let league = LEAGUES[0];
  let club   = league.clubs[0];
  let pName  = "Ù„Ø§Ø¹Ø¨";
  let score  = 0;
  let coins  = 0;
  let hp     = 3;

  // ØªØ±Ù‚ÙŠØ© Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚
  let skill = { speed:1.0, jump:1.0, luck:1.0, stamina:0, shield:0 };

  function syncHeader(){
    clubNameEl.textContent = club;
    leagueNameEl.textContent = league.name;
    scoreEl.textContent = score;
    spdEl.textContent = skill.speed.toFixed(2);
    hpEl.textContent = hp;
  }

  // ====== ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ======
  function fillLeagues(){
    leagueSelect.innerHTML = "";
    LEAGUES.forEach((l,idx)=>{
      const opt = document.createElement("option");
      opt.value = l.id;
      opt.textContent = l.name;
      if(idx===0) opt.selected = true;
      leagueSelect.appendChild(opt);
    });
  }
  function fillClubs(){
    clubSelect.innerHTML = "";
    league.clubs.forEach((c,idx)=>{
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      if(idx===0) opt.selected = true;
      clubSelect.appendChild(opt);
    });
  }

  fillLeagues();
  fillClubs();
  syncHeader();

  leagueSelect.addEventListener("change", ()=>{
    league = LEAGUES.find(x=>x.id===leagueSelect.value) || LEAGUES[0];
    club = league.clubs[0];
    fillClubs();
  });
  clubSelect.addEventListener("change", ()=>{ club = clubSelect.value; });

  // ====== Canvas Game Engine (2.5D Ø¹Ø§Ù„ÙŠ) ======
  const cv = $("cv");
  const ctx = cv.getContext("2d");
  function resize(){
    cv.width = Math.floor(innerWidth * devicePixelRatio);
    cv.height = Math.floor(innerHeight * devicePixelRatio);
    cv.style.width = innerWidth+"px";
    cv.style.height = innerHeight+"px";
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  addEventListener("resize", resize);
  resize();

  // Ù…Ø³Ø§Ø±Ø§Øª
  const lanes = [-140, 0, 140]; // X positions in screen-space
  let laneIndex = 1;

  // Ù„Ø§Ø¹Ø¨
  const player = {
    x: 0,
    y: 0,
    vy: 0,
    jumping:false,
    w: 58,
    h: 92
  };

  // Ø¹ÙˆØ§Ø¦Ù‚/Ù…ÙƒØ§ÙØ¢Øª
  const obstacles = [];
  const pickups = [];
  let t = 0;
  let speedZ = 7; // Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
  let gameRunning = false;

  function resetGame(){
    score = 0;
    coins = 0;
    hp = 3;
    skill = { speed:1.0, jump:1.0, luck:1.0, stamina:0, shield:0 };
    laneIndex = 1;
    player.x = lanes[laneIndex]/2;
    player.y = 0; player.vy = 0; player.jumping=false;
    obstacles.length = 0;
    pickups.length = 0;
    speedZ = 7;
    t = 0;
    syncHeader();
  }

  // Ø±Ø³Ù… Ø®Ù„ÙÙŠØ© Ù…Ù„Ø¹Ø¨ + Ø¥Ø¶Ø§Ø¡Ø©
  function drawBackground(){
    const w = innerWidth, h = innerHeight;

    // ØªØ¯Ø±Ø¬
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0, "rgba(13,25,70,1)");
    g.addColorStop(1, "rgba(5,7,13,1)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // Ø¨ÙˆÙƒÙŠÙ‡/Ù‡Ø§Ù„Ø©
    for(let i=0;i<4;i++){
      const x = (i*0.27+0.18)*w;
      const y = (i%2?0.28:0.18)*h;
      const r = 220 + i*50;
      const gg = ctx.createRadialGradient(x,y,0,x,y,r);
      gg.addColorStop(0, i%2 ? "rgba(255,191,85,.10)" : "rgba(77,121,255,.12)");
      gg.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = gg;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }

    // Ù†Ø¬ÙˆÙ…
    ctx.globalAlpha = 0.65;
    for(let i=0;i<70;i++){
      const x = (Math.sin(i*12.989+t*0.02)*0.5+0.5)*w;
      const y = (Math.sin(i*78.233+t*0.015)*0.5+0.5)*h*0.55;
      const s = (i%3?1.3:2.0);
      ctx.fillStyle = "rgba(255,255,255,.9)";
      ctx.fillRect(x,y,s,s);
    }
    ctx.globalAlpha = 1;

    // Ù…Ù„Ø¹Ø¨ (Ù…Ù†Ø¸ÙˆØ±)
    const topY = h*0.36;
    const botY = h*1.05;
    const leftTop = w*0.30;
    const rightTop= w*0.70;
    const leftBot = w*0.05;
    const rightBot= w*0.95;

    // Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ù…Ù„Ø¹Ø¨
    ctx.fillStyle = "rgba(10,18,40,.55)";
    ctx.beginPath();
    ctx.moveTo(leftTop, topY);
    ctx.lineTo(rightTop, topY);
    ctx.lineTo(rightBot, botY);
    ctx.lineTo(leftBot, botY);
    ctx.closePath();
    ctx.fill();

    // Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
    ctx.strokeStyle = "rgba(255,255,255,.10)";
    ctx.lineWidth = 2;
    for(let i=1;i<3;i++){
      const xTop = leftTop + (rightTop-leftTop)*(i/3);
      const xBot = leftBot + (rightBot-leftBot)*(i/3);
      ctx.beginPath();
      ctx.moveTo(xTop, topY);
      ctx.lineTo(xBot, botY);
      ctx.stroke();
    }

    // Ù„Ù…Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ© Ø®ÙÙŠÙØ©
    const glow = ctx.createRadialGradient(w/2, topY, 0, w/2, topY, 520);
    glow.addColorStop(0, "rgba(255,191,85,.10)");
    glow.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = glow;
    ctx.beginPath(); ctx.arc(w/2, topY, 520, 0, Math.PI*2); ctx.fill();
  }

  function worldToScreen(laneX, z){
    // Ù…Ù†Ø¸ÙˆØ± Ø¨Ø³ÙŠØ·: z Ù…Ù† 0 (Ù‚Ø±ÙŠØ¨) Ø¥Ù„Ù‰ 1 (Ø¨Ø¹ÙŠØ¯)
    const w = innerWidth, h = innerHeight;
    const topY = h*0.36;
    const botY = h*0.92;

    const p = 1 - z; // 1 Ù‚Ø±ÙŠØ¨
    const y = topY + (botY-topY)*(p*p); // Ù…Ù†Ø­Ù†Ù‰ ÙŠØ¹Ø·ÙŠ Ø¹Ù…Ù‚
    const xCenter = w/2;
    const spread = 320 * (p*p); // Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±
    const x = xCenter + (laneX/2) * (spread/160);
    const scale = 0.35 + (p*p)*0.95;
    return { x, y, scale };
  }

  function spawnObstacle(){
    const types = ["defender","ref","police"]; // Ø´Ø±Ø·Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠ
    const type = types[Math.floor(Math.random()*types.length)];
    const lane = Math.floor(Math.random()*3);
    obstacles.push({
      lane,
      z: 1.2,
      type,
      hit:false
    });
  }

  function spawnPickup(){
    const lane = Math.floor(Math.random()*3);
    pickups.push({
      lane,
      z: 1.2,
      kind: Math.random() < (0.25*skill.luck) ? "ball" : "star"
    });
  }

  function drawPlayer(){
    const w = innerWidth, h = innerHeight;
    const base = worldToScreen(lanes[laneIndex], 0.02);
    const x = base.x;
    const y = base.y - (player.jumping ? 90*player.jumpMul : 0);
    const s = base.scale;

    // Ø¸Ù„
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.beginPath();
    ctx.ellipse(x, base.y+24, 44*s, 16*s, 0, 0, Math.PI*2);
    ctx.fill();

    // Ø¬Ø³Ù… Ù„Ø§Ø¹Ø¨ (ÙƒØ±ØªÙˆÙ†ÙŠ Ø£Ù†ÙŠÙ‚)
    const bodyW = player.w*s, bodyH = player.h*s;
    const grd = ctx.createLinearGradient(x-bodyW/2,y-bodyH,x+bodyW/2,y+bodyH);
    grd.addColorStop(0,"rgba(77,121,255,.95)");
    grd.addColorStop(1,"rgba(43,85,255,.85)");
    ctx.fillStyle = grd;
    roundRect(x-bodyW/2, y-bodyH, bodyW, bodyH, 18*s);
    ctx.fill();

    // Ø±Ù‚Ù…/Ø´Ø¹Ø§Ø±
    ctx.fillStyle = "rgba(255,255,255,.88)";
    ctx.font = `${Math.max(14, 18*s)}px system-ui`;
    ctx.textAlign="center";
    ctx.fillText("10", x, y-bodyH*0.45);

    // ÙƒØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø¯Ù…
    ctx.fillStyle = "rgba(255,255,255,.90)";
    ctx.beginPath();
    ctx.arc(x+18*s, y+14*s, 10*s, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle="rgba(0,0,0,.25)";
    ctx.lineWidth=2;
    ctx.stroke();
  }

  function drawObstacle(o){
    const p = worldToScreen(lanes[o.lane], o.z);
    const x = p.x, y = p.y, s = p.scale;

    // Ø¸Ù„
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.beginPath();
    ctx.ellipse(x, y+18*s, 44*s, 14*s, 0, 0, Math.PI*2);
    ctx.fill();

    // Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    let a="#ff5b5b", b="#c92f2f", icon="ğŸ›¡ï¸";
    if(o.type==="ref"){ a="#ffffff"; b="#cfcfcf"; icon="ğŸ§‘â€âš–ï¸"; }
    if(o.type==="police"){ a="#1f2a44"; b="#0d1222"; icon="ğŸ‘®"; }

    const ww = 62*s, hh = 90*s;
    const grd = ctx.createLinearGradient(x-ww/2,y-hh,x+ww/2,y);
    grd.addColorStop(0, a);
    grd.addColorStop(1, b);

    ctx.fillStyle = grd;
    roundRect(x-ww/2, y-hh, ww, hh, 18*s);
    ctx.fill();

    // Ø£ÙŠÙ‚ÙˆÙ†Ø©
    ctx.font = `${Math.max(14, 20*s)}px system-ui`;
    ctx.textAlign="center";
    ctx.fillText(icon, x, y-hh*0.55);
  }

  function drawPickup(pu){
    const p = worldToScreen(lanes[pu.lane], pu.z);
    const x = p.x, y = p.y, s = p.scale;

    const r = 12*s;
    if(pu.kind==="star"){
      // Ù†Ø¬Ù…Ø© Ø°Ù‡Ø¨
      const gg = ctx.createRadialGradient(x,y,0,x,y,50*s);
      gg.addColorStop(0,"rgba(255,191,85,.95)");
      gg.addColorStop(1,"rgba(255,191,85,0)");
      ctx.fillStyle = gg;
      ctx.beginPath(); ctx.arc(x,y,r*3.2,0,Math.PI*2); ctx.fill();

      ctx.fillStyle="rgba(255,228,163,.95)";
      drawStar(x,y,r*1.3, r*0.6, 5);
      ctx.fill();
    }else{
      // ÙƒØ±Ø©
      ctx.fillStyle="rgba(255,255,255,.92)";
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle="rgba(0,0,0,.25)";
      ctx.lineWidth=2; ctx.stroke();
    }
  }

  function collideCheck(){
    // Ù‚Ø±Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ (z ~ 0.08)
    const nearZ = 0.08;

    // Ø¹Ø§Ø¦Ù‚
    for(const o of obstacles){
      if(o.hit) continue;
      if(o.lane !== laneIndex) continue;
      if(Math.abs(o.z - nearZ) < 0.035){
        o.hit = true;
        if(skill.shield > 0){
          skill.shield -= 1;
          // Ù„Ø§ ØªÙ†Ù‚Øµ Ø­ÙŠØ§Ø©
        }else{
          hp -= 1;
        }
        hpEl.textContent = hp;
        // ØªØ£Ø«ÙŠØ± Ø¶Ø±Ø¨Ø©
        shake(8);
        if(hp <= 0){
          gameRunning = false;
          openMarket(true);
        }
      }
    }

    // Ù…ÙƒØ§ÙØ£Ø©
    for(let i=pickups.length-1;i>=0;i--){
      const pu = pickups[i];
      if(pu.lane !== laneIndex) continue;
      if(Math.abs(pu.z - nearZ) < 0.035){
        pickups.splice(i,1);
        if(pu.kind==="star"){
          score += 10;
          coins += 15;
        }else{
          score += 6;
          coins += 8;
        }
        scoreEl.textContent = score;
        coinsEl.textContent = coins;
      }
    }
  }

  // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ·
  let shakeT = 0;
  function shake(frames){ shakeT = Math.max(shakeT, frames); }

  // Ø¬ÙÙ…Ø¨
  function jump(){
    if(player.jumping) return;
    player.jumping = true;
    player.vy = 16 * skill.jump;
    player.jumpMul = 1;
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ù…Ø³Ø§Ø±
  function moveLane(dir){
    laneIndex = Math.max(0, Math.min(2, laneIndex + dir));
  }

  // ØªØ­ÙƒÙ… keyboard
  addEventListener("keydown",(e)=>{
    if(!gameRunning) return;
    if(e.key==="ArrowLeft") moveLane(-1);
    if(e.key==="ArrowRight") moveLane(+1);
    if(e.key==="ArrowUp" || e.key===" ") jump();
  });

  // ØªØ­ÙƒÙ… Ù„Ù…Ø³
  let sx=0, sy=0, moved=false;
  cv.addEventListener("touchstart",(e)=>{
    if(!e.touches[0]) return;
    sx = e.touches[0].clientX;
    sy = e.touches[0].clientY;
    moved=false;
  },{passive:true});

  cv.addEventListener("touchmove",(e)=>{
    if(!e.touches[0]) return;
    const dx = e.touches[0].clientX - sx;
    const dy = e.touches[0].clientY - sy;
    if(Math.abs(dx)>26 || Math.abs(dy)>26) moved=true;
    if(!moved) return;
    if(Math.abs(dx) > Math.abs(dy)){
      if(dx > 0){ moveLane(-1); } // RTL: Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ† = ÙŠØ³Ø§Ø± Ù…Ø³Ø§Ø±
      else { moveLane(+1); }
      sx = e.touches[0].clientX; sy = e.touches[0].clientY;
    }else{
      if(dy < 0){ jump(); }
      sx = e.touches[0].clientX; sy = e.touches[0].clientY;
    }
  },{passive:true});

  // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø©/Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  btnRestart.addEventListener("click", ()=>{
    resetGame();
    settings.classList.remove("show");
    market.classList.remove("show");
    gameRunning = true;
  });
  btnSettings.addEventListener("click", ()=> settings.classList.add("show"));
  btnMarket.addEventListener("click", ()=> openMarket(false));
  closeMarket.addEventListener("click", ()=> market.classList.remove("show"));

  startGame.addEventListener("click", ()=>{
    league = LEAGUES.find(x=>x.id===leagueSelect.value) || LEAGUES[0];
    club = clubSelect.value || league.clubs[0];
    pName = (playerName.value || "Ù„Ø§Ø¹Ø¨").trim();
    settings.classList.remove("show");
    resetGame();
    syncHeader();
    gameRunning = true;
  });

  function openMarket(forced){
    pNameEl.textContent = pName;
    coinsEl.textContent = coins;
    score2El.textContent = score;
    renderTransfers();
    market.classList.add("show");
  }

  function renderTransfers(){
    transferList.innerHTML = "";
    TRANSFERS.forEach(tr=>{
      const div = document.createElement("div");
      div.className = "item";
      const left = document.createElement("div");
      left.innerHTML = `<div style="font-weight:1000">${tr.title}</div>
                        <div class="mini">${tr.type} â€¢ Ù…Ù†: ${tr.from} â†’ Ø¥Ù„Ù‰: ${tr.to}</div>`;
      const right = document.createElement("div");
      const b = document.createElement("button");
      b.className="btn";
      b.textContent = `Ø´Ø±Ø§Ø¡ ${tr.fee}ğŸ’°`;
      b.onclick = ()=>{
        if(coins < tr.fee) return alert("Ø±ØµÙŠØ¯Ùƒ Ù…Ø§ ÙŠÙƒÙÙŠ ğŸ’°");
        coins -= tr.fee;
        applyBonus(tr.bonus);
        coinsEl.textContent = coins;
        score2El.textContent = score;
        syncHeader();
      };
      right.appendChild(b);
      div.appendChild(left);
      div.appendChild(right);
      transferList.appendChild(div);
    });
  }

  function applyBonus(b){
    if(b.speed) skill.speed += b.speed;
    if(b.jump) skill.jump += b.jump;
    if(b.luck) skill.luck += b.luck;
    if(b.stamina) hp += b.stamina;
    if(b.shield) skill.shield += b.shield;
    hpEl.textContent = hp;
  }

  // ====== Loop ======
  function step(){
    requestAnimationFrame(step);
    t += 1;

    // Ø§Ù‡ØªØ²Ø§Ø²
    let ox=0, oy=0;
    if(shakeT>0){
      shakeT--;
      ox = (Math.random()-0.5)*6;
      oy = (Math.random()-0.5)*6;
    }
    ctx.save();
    ctx.translate(ox, oy);

    drawBackground();

    // ØªØ­Ø¯ÙŠØ« Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨
    if(gameRunning){
      // ØªØ³Ø§Ø±Ø¹ ØªØ¯Ø±ÙŠØ¬ÙŠ
      speedZ = Math.min(16, speedZ + 0.002 + (score/80000));
      // Ø³Ø±Ø¹Ø© Ù…Ø¹ Ù…Ù‡Ø§Ø±Ø©
      const dz = (speedZ * skill.speed) / 300;

      // ØªÙˆÙ„ÙŠØ¯
      if(t % Math.floor(70/Math.max(1, skill.speed)) === 0) spawnObstacle();
      if(t % Math.floor(50/Math.max(1, skill.luck)) === 0) spawnPickup();

      // ÙÙŠØ²ÙŠØ§Ø¡ Ù‚ÙØ²
      if(player.jumping){
        player.vy -= 0.9;
        if(player.vy <= 0) player.jumpMul = 0.85;
        if(player.vy < -18) player.vy = -18;
        // Ù†Ù…Ø«Ù„ Ø§Ù„Ù‚ÙØ² Ø¨Ø§Ù„Ø¥Ø±ØªÙØ§Ø¹ Ø¹Ø¨Ø± â€œjumpingâ€
        if(player.vy < -14){
          player.jumping = false;
          player.vy = 0;
        }
      }

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù†Ø­Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨
      for(let i=obstacles.length-1;i>=0;i--){
        obstacles[i].z -= dz;
        if(obstacles[i].z < -0.2) obstacles.splice(i,1);
      }
      for(let i=pickups.length-1;i>=0;i--){
        pickups[i].z -= dz;
        if(pickups[i].z < -0.2) pickups.splice(i,1);
      }

      // Ù†Ù‚Ø§Ø· Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
      score += Math.floor(speedZ * 0.03);
      scoreEl.textContent = score;

      collideCheck();
    }

    // Ø±Ø³Ù… (Ø§Ù„Ø£Ø¨Ø¹Ø¯ Ø£ÙˆÙ„Ø§Ù‹)
    const all = [];
    obstacles.forEach(o=>all.push({kind:"o", z:o.z, ref:o}));
    pickups.forEach(p=>all.push({kind:"p", z:p.z, ref:p}));
    all.sort((a,b)=> b.z - a.z);
    for(const it of all){
      if(it.kind==="o") drawObstacle(it.ref);
      else drawPickup(it.ref);
    }

    drawPlayer();

    ctx.restore();
  }
  step();

  // Helpers
  function roundRect(x,y,w,h,r){
    r = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }
  function drawStar(cx, cy, outerR, innerR, points){
    let rot = Math.PI / 2 * 3;
    let x = cx, y = cy;
    const step = Math.PI / points;
    ctx.beginPath();
    ctx.moveTo(cx, cy - outerR);
    for (let i = 0; i < points; i++) {
      x = cx + Math.cos(rot) * outerR;
      y = cy + Math.sin(rot) * outerR;
      ctx.lineTo(x, y);
      rot += step;

      x = cx + Math.cos(rot) * innerR;
      y = cy + Math.sin(rot) * innerR;
      ctx.lineTo(x, y);
      rot += step;
    }
    ctx.lineTo(cx, cy - outerR);
    ctx.closePath();
  }

})();
</script>
</body>
</html>
