<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø±Ù…Ø¶Ø§Ù†ÙŠØ© 3D</title>
  <style>
    :root{
      --bg0:#05070d;
      --bg1:#070b14;
      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text:#fff;
      --muted: rgba(255,255,255,.75);
      --goldA:#ffe6b0;
      --goldB:#ffbf55;
      --blueA:#4d79ff;
      --blueB:#2b55ff;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 26px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      height:100vh;
      overflow:hidden;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(900px 520px at 70% 0%, rgba(255,191,85,.10), transparent 60%),
                  radial-gradient(900px 520px at 20% 20%, rgba(77,121,255,.14), transparent 60%),
                  linear-gradient(180deg, #0b1330, #05070d);
      color:var(--text);
    }

    /* Canvas */
    #c{ position:fixed; inset:0; display:block; }

    /* HUD */
    .hud{
      position: fixed;
      top: 14px;
      left: 14px;
      right: 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      z-index:10;
      pointer-events:none;
    }

    .pill{
      pointer-events:auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.90);
      font-weight: 900;
      font-size: 14px;
      user-select:none;
      white-space:nowrap;
    }

    .btn{
      pointer-events:auto;
      border:0;
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      color:#fff;
      background: linear-gradient(135deg, var(--blueA), var(--blueB));
      box-shadow: 0 14px 35px rgba(43,85,255,.25), var(--shadow);
    }
    .btn:active{ transform: translateY(1px); }

    .hint{
      position: fixed;
      bottom: 14px;
      left: 14px;
      right: 14px;
      z-index:10;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .hint .card{
      pointer-events:auto;
      width:min(720px, 100%);
      padding: 12px 14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      color: var(--muted);
      font-weight: 900;
      text-align:center;
    }

    a.back{
      pointer-events:auto;
      text-decoration:none;
      color:#fff;
      opacity:.95;
    }

    .centerToast{
      position: fixed;
      inset: 0;
      display:none;
      place-items:center;
      z-index: 20;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }
    .centerToast.show{ display:grid; }
    .centerToast .box{
      width:min(520px, 92%);
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 26px 90px rgba(0,0,0,.65);
      padding: 18px 16px;
      text-align:center;
    }
    .centerToast h2{ margin:6px 0 8px; font-size: 22px; }
    .centerToast p{ margin:0 0 12px; color: rgba(255,255,255,.75); font-weight: 800; }
    .row{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<div class="hud">
  <div class="pill"><a class="back" href="index.html">â¬…ï¸ Ø±Ø¬ÙˆØ¹</a></div>
  <div class="pill" id="status">â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span> â€” â³ Ø§Ù„ÙˆÙ‚Øª: <span id="time">60</span>s</div>
  <button class="btn" id="restart">Ø¥Ø¹Ø§Ø¯Ø©</button>
</div>

<div class="hint">
  <div class="card">
    ğŸ“± Ø¨Ø§Ù„Ø¬ÙˆØ§Ù„: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¬Ù…Ø©/Ø§Ù„ÙØ§Ù†ÙˆØ³ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¸Ù‡Ø± â€” ğŸ–¥ï¸ Ø¨Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: Ø§Ù†Ù‚Ø± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³. (Ø§Ø³Ø­Ø¨ Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§)
  </div>
</div>

<div class="centerToast" id="end">
  <div class="box">
    <h2>ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©</h2>
    <p>Ù†ØªÙŠØ¬ØªÙƒ: <b id="finalScore">0</b> Ù†Ù‚Ø·Ø©</p>
    <div class="row">
      <button class="btn" id="again">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
      <a class="btn" href="index.html" style="display:inline-flex;align-items:center;justify-content:center;text-decoration:none;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </div>
</div>

<!-- Three.js (WebGL) -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
(() => {
  const canvas = document.getElementById('c');

  // Renderer
  const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  renderer.setSize(innerWidth, innerHeight);
  renderer.outputColorSpace = THREE.SRGBColorSpace;

  // Scene / Camera
  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x05070d, 0.03);

  const camera = new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 200);
  camera.position.set(0, 6.5, 14);

  // Lights (Ø±Ù…Ø¶Ø§Ù†ÙŠ Ø°Ù‡Ø¨ÙŠ)
  const hemi = new THREE.HemisphereLight(0x8fb3ff, 0x0b1020, 0.9);
  scene.add(hemi);

  const key = new THREE.DirectionalLight(0xfff2d5, 1.2);
  key.position.set(8, 10, 6);
  key.castShadow = false;
  scene.add(key);

  const warm = new THREE.PointLight(0xffc15a, 1.6, 40);
  warm.position.set(0, 6, 0);
  scene.add(warm);

  // Ground (Ø£Ø±Ø¶ÙŠØ© Ù…Ø¹ Ù„Ù…Ø¹Ø©)
  const groundGeo = new THREE.PlaneGeometry(80, 80, 1, 1);
  const groundMat = new THREE.MeshStandardMaterial({
    color: 0x0b1330,
    metalness: 0.25,
    roughness: 0.45,
    emissive: 0x05070d,
    emissiveIntensity: 0.35
  });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI/2;
  ground.position.y = -0.6;
  scene.add(ground);

  // Subtle floor glow ring
  const ringGeo = new THREE.RingGeometry(6, 10, 64);
  const ringMat = new THREE.MeshBasicMaterial({ color: 0xffc15a, transparent:true, opacity:0.08, side:THREE.DoubleSide });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ring.rotation.x = -Math.PI/2;
  ring.position.y = -0.58;
  scene.add(ring);

  // Moon (Ù‚Ù…Ø± 3D)
  const moon = new THREE.Mesh(
    new THREE.SphereGeometry(1.8, 48, 48),
    new THREE.MeshStandardMaterial({
      color: 0xffe6b0,
      metalness: 0.65,
      roughness: 0.25,
      emissive: 0xffc15a,
      emissiveIntensity: 0.18
    })
  );
  moon.position.set(-6, 10.5, -22);
  scene.add(moon);

  // Crescent cut (Ù‡Ù„Ø§Ù„)
  const crescent = new THREE.Mesh(
    new THREE.SphereGeometry(1.65, 48, 48),
    new THREE.MeshStandardMaterial({ color: 0x05070d, roughness: 1, metalness: 0 })
  );
  crescent.position.set(-5.35, 10.75, -21.4);
  scene.add(crescent);

  // Mosque silhouette (Ù…Ø³Ø¬Ø¯ Ø¨Ø³ÙŠØ· 3D)
  function addMosque(){
    const g = new THREE.Group();

    const base = new THREE.Mesh(
      new THREE.BoxGeometry(10, 2.2, 3.6),
      new THREE.MeshStandardMaterial({ color: 0x0b1020, roughness: 0.7, metalness: 0.1 })
    );
    base.position.set(0, 0.6, -18);
    g.add(base);

    const dome = new THREE.Mesh(
      new THREE.SphereGeometry(1.8, 32, 32, 0, Math.PI*2, 0, Math.PI/2),
      new THREE.MeshStandardMaterial({ color: 0x0b1020, roughness: 0.6, metalness: 0.15 })
    );
    dome.position.set(0, 2.0, -18);
    g.add(dome);

    const towerMat = new THREE.MeshStandardMaterial({ color: 0x0b1020, roughness: 0.65, metalness: 0.1 });
    const min1 = new THREE.Mesh(new THREE.CylinderGeometry(0.55, 0.75, 5.2, 18), towerMat);
    min1.position.set(-4.2, 2.1, -18);
    g.add(min1);

    const min2 = min1.clone();
    min2.position.set(4.2, 2.1, -18);
    g.add(min2);

    // Golden rim light behind mosque
    const glow = new THREE.PointLight(0xffc15a, 2.4, 35);
    glow.position.set(0, 3.5, -17.2);
    g.add(glow);

    scene.add(g);
  }
  addMosque();

  // Stars field (Ù†Ø¬ÙˆÙ… Ø®Ù„ÙÙŠØ©)
  const starGeo = new THREE.BufferGeometry();
  const starCount = 900;
  const pos = new Float32Array(starCount * 3);
  for(let i=0;i<starCount;i++){
    pos[i*3+0] = (Math.random()-0.5)*160;
    pos[i*3+1] = Math.random()*70 + 3;
    pos[i*3+2] = (Math.random()-0.5)*160 - 40;
  }
  starGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.06, transparent:true, opacity:0.8 });
  const stars = new THREE.Points(starGeo, starMat);
  scene.add(stars);

  // Lanterns (ÙÙˆØ§Ù†ÙŠØ³ Ù…Ø¶ÙŠØ¦Ø© 3D)
  function makeLantern(){
    const g = new THREE.Group();

    const frameMat = new THREE.MeshStandardMaterial({ color: 0x2a2a2a, metalness: 0.5, roughness: 0.35 });
    const glassMat = new THREE.MeshStandardMaterial({
      color: 0xffe6b0,
      metalness: 0.1,
      roughness: 0.12,
      transparent:true,
      opacity:0.45,
      emissive: 0xffc15a,
      emissiveIntensity: 0.6
    });

    const body = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.65, 1.8, 14), frameMat);
    g.add(body);

    const glass = new THREE.Mesh(new THREE.CylinderGeometry(0.35, 0.45, 1.3, 14), glassMat);
    glass.position.y = 0.02;
    g.add(glass);

    const cap = new THREE.Mesh(new THREE.ConeGeometry(0.7, 0.6, 14), frameMat);
    cap.position.y = 1.2;
    g.add(cap);

    const base = new THREE.Mesh(new THREE.ConeGeometry(0.65, 0.5, 14), frameMat);
    base.position.y = -1.1;
    g.add(base);

    const light = new THREE.PointLight(0xffc15a, 1.4, 10);
    light.position.y = 0.2;
    g.add(light);

    return g;
  }

  const lanterns = new THREE.Group();
  for(let i=0;i<7;i++){
    const L = makeLantern();
    const a = (i/7) * Math.PI*2;
    const r = 7.5;
    L.position.set(Math.cos(a)*r, 2.8 + Math.random()*0.8, Math.sin(a)*r - 2);
    L.rotation.y = Math.random()*Math.PI;
    lanterns.add(L);
  }
  scene.add(lanterns);

  // Collectibles (Ù†Ø¬Ù…Ø© ØªØ¬Ù…Ø¹Ù‡Ø§)
  const pickables = [];
  const raycaster = new THREE.Raycaster();
  const pointer = new THREE.Vector2();

  function makeStar(){
    // Ù†Ø³ØªØ®Ø¯Ù… Octahedron Ù…Ø¹ material Ø°Ù‡Ø¨ÙŠ + glow
    const star = new THREE.Mesh(
      new THREE.OctahedronGeometry(0.42, 0),
      new THREE.MeshStandardMaterial({
        color: 0xffe6b0,
        metalness: 0.9,
        roughness: 0.15,
        emissive: 0xffc15a,
        emissiveIntensity: 0.55
      })
    );

    // Ù‡Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ø­ÙˆÙ„ Ø§Ù„Ù†Ø¬Ù…Ø©
    const halo = new THREE.Mesh(
      new THREE.SphereGeometry(0.72, 18, 18),
      new THREE.MeshBasicMaterial({ color: 0xffc15a, transparent:true, opacity:0.14 })
    );
    star.add(halo);

    star.userData.vy = 0.0;
    star.userData.spin = (Math.random()*0.8 + 0.2) * (Math.random()<0.5 ? -1 : 1);
    return star;
  }

  let currentStar = null;
  function spawnStar(){
    if(currentStar) scene.remove(currentStar);

    currentStar = makeStar();
    currentStar.position.set(
      (Math.random()-0.5)*10,
      1.2 + Math.random()*3.2,
      (Math.random()-0.5)*10 - 1
    );
    scene.add(currentStar);
    pickables.length = 0;
    pickables.push(currentStar);
  }

  // Particles burst Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
  function burst(position){
    const count = 36;
    const g = new THREE.Group();
    for(let i=0;i<count;i++){
      const p = new THREE.Mesh(
        new THREE.SphereGeometry(0.06, 10, 10),
        new THREE.MeshBasicMaterial({ color: 0xffc15a, transparent:true, opacity:0.9 })
      );
      p.position.copy(position);
      p.userData.v = new THREE.Vector3(
        (Math.random()-0.5)*2.4,
        (Math.random())*2.4,
        (Math.random()-0.5)*2.4
      );
      g.add(p);
    }
    scene.add(g);

    let t = 0;
    const id = setInterval(()=>{
      t += 1;
      g.children.forEach(ch=>{
        ch.position.addScaledVector(ch.userData.v, 0.04);
        ch.material.opacity *= 0.94;
      });
      if(t > 40){
        clearInterval(id);
        scene.remove(g);
      }
    }, 16);
  }

  // Simple camera orbit via drag (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª)
  let dragging = false;
  let lastX=0, lastY=0;
  let yaw = 0, pitch = -0.15;
  function applyCam(){
    const radius = 14;
    const x = Math.sin(yaw)*Math.cos(pitch)*radius;
    const y = 6.2 + Math.sin(pitch)*5;
    const z = Math.cos(yaw)*Math.cos(pitch)*radius;
    camera.position.set(x, y, z);
    camera.lookAt(0, 2.2, -2);
  }
  applyCam();

  function onDown(e){
    dragging = true;
    const t = e.touches ? e.touches[0] : e;
    lastX = t.clientX; lastY = t.clientY;
  }
  function onMove(e){
    if(!dragging) return;
    const t = e.touches ? e.touches[0] : e;
    const dx = (t.clientX - lastX);
    const dy = (t.clientY - lastY);
    lastX = t.clientX; lastY = t.clientY;
    yaw -= dx * 0.0045;
    pitch -= dy * 0.0035;
    pitch = Math.max(-0.55, Math.min(0.22, pitch));
    applyCam();
  }
  function onUp(){ dragging = false; }

  canvas.addEventListener('mousedown', onDown);
  window.addEventListener('mousemove', onMove);
  window.addEventListener('mouseup', onUp);

  canvas.addEventListener('touchstart', onDown, {passive:true});
  window.addEventListener('touchmove', onMove, {passive:true});
  window.addEventListener('touchend', onUp, {passive:true});

  // Click/tap to collect
  function pickAt(clientX, clientY){
    const rect = canvas.getBoundingClientRect();
    pointer.x = ((clientX - rect.left) / rect.width) * 2 - 1;
    pointer.y = -(((clientY - rect.top) / rect.height) * 2 - 1);
    raycaster.setFromCamera(pointer, camera);
    const hits = raycaster.intersectObjects(pickables, true);
    if(hits.length){
      // Ø§Ø¬Ù…Ø¹
      score += 1;
      document.getElementById('score').textContent = score;
      burst(currentStar.position.clone());
      spawnStar();
    }
  }

  canvas.addEventListener('click', (e)=>{
    // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØ§Ù† ÙŠØ³Ø­Ø¨ ÙƒØ«ÙŠØ±ØŒ Ù†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ÙƒÙ„ÙŠÙƒ (Ø­Ù„ Ø¨Ø³ÙŠØ·)
    pickAt(e.clientX, e.clientY);
  });

  canvas.addEventListener('touchend', (e)=>{
    const t = e.changedTouches && e.changedTouches[0];
    if(!t) return;
    pickAt(t.clientX, t.clientY);
  }, {passive:true});

  // UI logic
  const end = document.getElementById('end');
  const finalScore = document.getElementById('finalScore');
  const btnRestart = document.getElementById('restart');
  const btnAgain = document.getElementById('again');

  let score = 0;
  let timeLeft = 60;
  let playing = true;

  function reset(){
    score = 0;
    timeLeft = 60;
    playing = true;
    end.classList.remove('show');
    document.getElementById('score').textContent = score;
    document.getElementById('time').textContent = timeLeft;
    spawnStar();
  }

  btnRestart.addEventListener('click', reset);
  btnAgain.addEventListener('click', reset);

  // Timer
  setInterval(()=>{
    if(!playing) return;
    timeLeft -= 1;
    document.getElementById('time').textContent = timeLeft;
    if(timeLeft <= 0){
      playing = false;
      finalScore.textContent = score;
      end.classList.add('show');
    }
  }, 1000);

  // Animate
  const clock = new THREE.Clock();
  spawnStar();

  function animate(){
    requestAnimationFrame(animate);

    const t = clock.getElapsedTime();

    // Ù†Ø¬ÙˆÙ… Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØªØ­Ø±Ùƒ Ø®ÙÙŠÙ
    stars.rotation.y = t * 0.02;

    // ÙÙˆØ§Ù†ÙŠØ³ ØªØªÙ…Ø§ÙŠÙ„
    lanterns.children.forEach((l, i)=>{
      l.rotation.z = Math.sin(t*0.9 + i) * 0.08;
      l.position.y += Math.sin(t*0.8 + i) * 0.002;
    });

    // Ø§Ù„Ù†Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: Ø¯ÙˆØ±Ø§Ù† + ÙˆÙ…ÙŠØ¶ + Ø­Ø±ÙƒØ© Ù„Ø·ÙŠÙØ©
    if(currentStar){
      currentStar.rotation.y += 0.03 * currentStar.userData.spin;
      currentStar.rotation.x += 0.01;
      const pulse = 0.65 + Math.sin(t*4.2)*0.25;
      currentStar.material.emissiveIntensity = 0.35 + pulse*0.55;
      currentStar.position.y += Math.sin(t*3.0) * 0.0025;
    }

    ring.material.opacity = 0.06 + Math.sin(t*1.2)*0.02;

    renderer.render(scene, camera);
  }
  animate();

  // Resize
  addEventListener('resize', ()=>{
    renderer.setSize(innerWidth, innerHeight);
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
  });

})();
</script>

</body>
</html>
