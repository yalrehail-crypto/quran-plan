<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…ÙƒØªØ¨ØªÙŠ</title>

  <style>
    :root{
      --bg:#081426;
      --card:#0f2140cc;
      --text:#ffffff;
      --muted:#b9c6df;
      --muted2:#93a4c6;
      --accent:#3f66ff;
      --accent2:#2b4dd6;
      --shadow: 0 20px 50px rgba(0,0,0,.35);
      --radius: 26px;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% -200px, #143261 0%, var(--bg) 55%, #050b14 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:24px 14px 60px;
    }

    .wrap{ width:min(980px, 100%); }

    .card{
      background: linear-gradient(180deg, rgba(14,33,70,.95), rgba(10,22,45,.92));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
    }

    .topbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .title{
      font-weight: 1000;
      font-size: 30px;
      margin:0;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .title small{
      font-size: 14px;
      color: rgba(255,255,255,.65);
      font-weight: 800;
    }

    .nav{
      display:flex;
      gap:8px;
      flex-wrap: wrap;
    }
    .nav a{
      text-decoration:none;
      color:white;
      font-weight:900;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius: 14px;
    }
    .nav a.active{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border-color: transparent;
      box-shadow: 0 18px 45px rgba(63,102,255,.22);
    }

    .searchRow{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin: 10px 0 14px;
    }
    .input{
      flex: 1 1 240px;
      border:none;
      outline:none;
      background: #f3f5f9;
      padding: 14px 14px;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 800;
      color:#111827;
    }
    .pill{
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
      border-radius: 16px;
      font-weight: 900;
      color: rgba(255,255,255,.92);
    }

    .cats{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin: 14px 0 18px;
    }
    @media (min-width: 720px){
      .cats{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    .catBtn{
      border:none;
      outline:none;
      cursor:pointer;
      text-align:right;
      padding: 16px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color:white;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      transition: transform .06s ease, border-color .2s ease;
      min-height: 64px;
    }
    .catBtn:active{ transform: scale(.99); }
    .catBtn.active{
      border-color: rgba(63,102,255,.55);
      box-shadow: 0 0 0 3px rgba(63,102,255,.18);
      background: rgba(63,102,255,.10);
    }
    .catName{
      font-weight: 1000;
      font-size: 18px;
      line-height: 1.2;
    }
    .catMeta{
      color: rgba(255,255,255,.65);
      font-weight: 900;
      font-size: 13px;
      margin-top: 4px;
    }
    .catIcon{
      width: 44px; height: 44px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      flex: 0 0 auto;
      font-size: 20px;
    }

    .booksHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap: wrap;
      margin: 8px 0 10px;
      padding-top: 8px;
      border-top:1px solid rgba(255,255,255,.10);
    }
    .booksHeader h2{
      margin:0;
      font-size: 20px;
      font-weight: 1000;
    }
    .muted{
      color: rgba(255,255,255,.65);
      font-weight: 800;
      font-size: 13px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }
    @media (min-width: 720px){
      .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    }

    .bookCard{
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 210px;
    }
    .cover{
      height: 120px;
      background: linear-gradient(135deg, rgba(63,102,255,.25), rgba(255,255,255,.06));
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 34px;
      font-weight: 1000;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .bookBody{
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      flex:1;
    }
    .bookTitle{
      font-weight: 1000;
      font-size: 15px;
      line-height: 1.4;
      max-height: 44px;
      overflow:hidden;
    }
    .bookInfo{
      color: rgba(255,255,255,.70);
      font-weight: 800;
      font-size: 12px;
      line-height:1.6;
    }
    .actions{
      display:flex;
      gap:8px;
      margin-top:auto;
    }
    .btn{
      flex:1;
      border:none;
      outline:none;
      cursor:pointer;
      padding:10px 10px;
      border-radius: 14px;
      font-weight: 1000;
      color:white;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border-color: transparent;
      box-shadow: 0 12px 34px rgba(63,102,255,.25);
    }

    /* Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ PDF */
    .modal{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index: 9999;
    }
    .modal.show{ display:flex; }
    .modalBox{
      width:min(980px, 100%);
      height:min(85vh, 720px);
      background: #0a1630;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 25px 80px rgba(0,0,0,.65);
      display:flex;
      flex-direction:column;
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .modalTop b{ font-weight: 1000; }
    .closeBtn{
      border:none;
      outline:none;
      cursor:pointer;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      color:white;
      padding:8px 12px;
      border-radius: 12px;
      font-weight: 1000;
    }
    .pdfFrame{
      width:100%;
      height:100%;
      border:0;
      background: #0a1630;
    }

    .empty{
      padding:18px;
      border:1px dashed rgba(255,255,255,.18);
      border-radius: 18px;
      color: rgba(255,255,255,.75);
      font-weight: 900;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="topbar">
        <h1 class="title">ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ <small id="subtitle">â€”</small></h1>

        <div class="nav">
          <a href="./index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="./quran.html">Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†</a>
          <a href="./calendar.html">ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</a>
          <a class="active" href="./library.html">Ù…ÙƒØªØ¨ØªÙŠ</a>
        </div>
      </div>

      <div class="searchRow">
        <input id="searchInput" class="input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ (Ø¹Ù†ÙˆØ§Ù†/Ù…Ø¤Ù„Ù)..." />
        <div class="pill" id="countPill">â€”</div>
      </div>

      <div class="cats" id="cats"></div>

      <div class="booksHeader">
        <h2 id="sectionTitle">Ø§Ù„ÙƒØªØ¨</h2>
        <div class="muted" id="sectionHint">Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨</div>
      </div>

      <div class="grid" id="grid"></div>

      <div id="empty" class="empty" style="display:none;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¢Ù†.  
        <div style="margin-top:8px;font-size:12px;color:rgba(255,255,255,.6);font-weight:800">
          Ø£Ø¶Ù Ù…Ù„ÙØ§Øª PDF Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ <b>pdf/</b> Ø«Ù… Ø­Ø¯Ù‘Ø« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØªØ¨ ÙÙŠ <b>library-data.js</b>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modalBox">
      <div class="modalTop">
        <b id="modalTitle">â€”</b>
        <button class="closeBtn" id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <iframe class="pdfFrame" id="pdfFrame" title="PDF Preview"></iframe>
    </div>
  </div>

  <script src="./maintenance.js"></script>
  <script src="./library-data.js"></script>

  <script>
    // libraryData Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ library-data.js
    const catsEl = document.getElementById("cats");
    const gridEl = document.getElementById("grid");
    const emptyEl = document.getElementById("empty");
    const sectionTitleEl = document.getElementById("sectionTitle");
    const sectionHintEl = document.getElementById("sectionHint");
    const subtitleEl = document.getElementById("subtitle");
    const countPillEl = document.getElementById("countPill");
    const searchInput = document.getElementById("searchInput");

    const modal = document.getElementById("modal");
    const pdfFrame = document.getElementById("pdfFrame");
    const modalTitle = document.getElementById("modalTitle");
    const closeBtn = document.getElementById("closeBtn");

    let activeCat = "all";

    function normalize(s){
      return (s || "")
        .toString()
        .trim()
        .toLowerCase();
    }

    function openPdf(book){
      modalTitle.textContent = book.title;
      // Ø§ÙØªØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø¨Ø¯ÙˆÙ† ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ)
      pdfFrame.src = book.pdf;
      modal.classList.add("show");
    }

    function closeModal(){
      modal.classList.remove("show");
      pdfFrame.src = "about:blank";
    }

    closeBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{
      if(e.target === modal) closeModal();
    });

    function renderCats(){
      catsEl.innerHTML = "";
      const cats = libraryData.categories;

      cats.forEach(cat=>{
        const btn = document.createElement("button");
        btn.className = "catBtn" + (cat.id === activeCat ? " active" : "");
        btn.innerHTML = `
          <div>
            <div class="catName">${cat.name}</div>
            <div class="catMeta">${cat.hint || ""}</div>
          </div>
          <div class="catIcon">${cat.icon || "ğŸ“š"}</div>
        `;
        btn.addEventListener("click", ()=>{
          activeCat = cat.id;
          renderCats();
          renderBooks();
        });
        catsEl.appendChild(btn);
      });
    }

    function getFilteredBooks(){
      const q = normalize(searchInput.value);
      let list = libraryData.books.slice();

      if(activeCat !== "all"){
        list = list.filter(b => b.category === activeCat);
      }

      if(q){
        list = list.filter(b => {
          const t = normalize(b.title);
          const a = normalize(b.author);
          return t.includes(q) || a.includes(q);
        });
      }

      return list;
    }

    function renderBooks(){
      const list = getFilteredBooks();

      const catObj = libraryData.categories.find(c => c.id === activeCat);
      sectionTitleEl.textContent = catObj ? catObj.name : "Ø§Ù„ÙƒØªØ¨";
      sectionHintEl.textContent = catObj ? (catObj.hint || "") : "Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨";

      countPillEl.textContent = `ğŸ“„ Ø§Ù„ÙƒØªØ¨: ${list.length}`;

      gridEl.innerHTML = "";
      emptyEl.style.display = (list.length === 0) ? "block" : "none";

      list.forEach(book=>{
        const card = document.createElement("div");
        card.className = "bookCard";

        const coverText = (book.coverText || "PDF").toString().slice(0,3);

        card.innerHTML = `
          <div class="cover">${coverText}</div>
          <div class="bookBody">
            <div class="bookTitle">${book.title}</div>
            <div class="bookInfo">
              ${book.author ? `âœï¸ ${book.author}<br>` : ""}
              ${book.year ? `ğŸ“… ${book.year}<br>` : ""}
              ${book.license ? `âœ… ${book.license}` : ""}
            </div>
            <div class="actions">
              <button class="btn primary">Ø¹Ø±Ø¶</button>
              <a class="btn" href="${book.pdf}" download style="text-decoration:none; display:grid; place-items:center;">
                ØªØ­Ù…ÙŠÙ„
              </a>
            </div>
          </div>
        `;

        card.querySelector(".btn.primary").addEventListener("click", ()=>openPdf(book));
        gridEl.appendChild(card);
      });

      subtitleEl.textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleDateString("ar-SA")}`;
    }

    searchInput.addEventListener("input", renderBooks);

    // ØªØ´ØºÙŠÙ„
    renderCats();
    renderBooks();
  </script>
</body>
</html>
